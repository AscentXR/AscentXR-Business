<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Ascent XR Dashboard v19</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="agent_coordination_styles.css">
    <style>
        :root {
            --primary: #0a1d45;
            --primary-dark: #071732;
            --secondary: #132e5e;
            --success: #ff6b00;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --dark-border: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --gradient-primary: linear-gradient(135deg, #071732 0%, #0a1d45 100%);
            --gradient-success: linear-gradient(135deg, #ff6b00 0%, #0d9488 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
        }
        
        .dashboard {
            max-width: 1800px;
            margin: 0 auto;
            background: var(--dark-bg);
            border-radius: 24px;
            box-shadow: 0 25px 75px rgba(0,0,0,0.5);
            overflow: hidden;
            border: 1px solid var(--dark-border);
        }
        
        /* HEADER */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .header-content h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-content .subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
            color: rgba(255,255,255,0.9);
        }
        
        .header-stats {
            display: flex;
            gap: 20px;
        }
        
        .header-stat {
            text-align: center;
            padding: 12px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .header-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .header-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* MAIN GRID - 3 COLUMN LAYOUT */
        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            gap: 0;
            min-height: calc(100vh - 180px);
        }
        
        /* LEFT SIDEBAR - NAVIGATION */
        .sidebar-left {
            padding: 25px;
            background: var(--dark-card);
            border-right: 1px solid var(--dark-border);
        }
        
        .nav-section {
            margin-bottom: 30px;
        }
        
        .nav-title {
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 10px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: var(--dark-bg);
            border-radius: 10px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .nav-link:hover, .nav-link.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .nav-link i {
            width: 20px;
            text-align: center;
        }
        
        /* MOBILE MENU STYLES */
        .mobile-menu-toggle {
            display: none;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }
        
        .mobile-menu-toggle:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .mobile-menu-close {
            display: none;
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .mobile-menu-close:hover {
            background: var(--dark-border);
            color: var(--text-primary);
        }
        
        /* BREADCRUMBS */
        .breadcrumbs {
            background: var(--dark-card);
            border-bottom: 1px solid var(--dark-border);
            padding: 12px 40px;
        }
        
        .breadcrumb-container {
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .breadcrumb-item:hover {
            color: var(--primary);
            background: rgba(255,255,255,0.05);
        }
        
        .breadcrumb-separator {
            color: var(--text-muted);
            font-size: 0.8rem;
        }
        
        .breadcrumb-current {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* VIEW CONTAINERS */
        .view-container {
            display: none;
            animation: fadeInView 0.3s ease forwards;
        }
        
        .view-container.active {
            display: block;
        }
        
        @keyframes fadeInView {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* VIEW TRANSITION OVERLAY */
        .view-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark-bg);
            z-index: 9998;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }
        
        .view-transition-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        /* CENTER CONTENT AREA */
        .content-area {
            padding: 30px;
            overflow-y: auto;
            max-height: calc(100vh - 180px);
        }
        
        /* RIGHT SIDEBAR - QUICK ACTIONS & INFO */
        .sidebar-right {
            padding: 25px;
            background: var(--dark-card);
            border-left: 1px solid var(--dark-border);
            overflow-y: auto;
            max-height: calc(100vh - 180px);
        }
        .sidebar-right .section { margin-bottom: 24px; }
        .sidebar-right .section-header { margin-bottom: 15px; padding-bottom: 10px; }
        .sidebar-right .section-title { font-size: 1.1rem; }
        .sidebar-right .quick-stats-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
        .sidebar-right .quick-stat { padding:12px; background:var(--dark-card); border-radius:10px; text-align:center; border:1px solid var(--dark-border); }
        .sidebar-right .quick-stat-value { font-size:1.3rem; font-weight:700; }
        .sidebar-right .quick-stat-label { font-size:0.75rem; color:var(--text-secondary); margin-top:4px; }
        .notification-list { list-style:none; padding:0; max-height:250px; overflow-y:auto; }
        .notification-item { padding:12px; border-bottom:1px solid var(--dark-border); font-size:0.85rem; color:var(--text-secondary); }
        .notification-item.success { border-left:3px solid #10b981; }
        .notification-item.warning { border-left:3px solid var(--warning); }
        .notification-item.info { border-left:3px solid var(--info); }
        .notification-item.error { border-left:3px solid var(--danger); }
        .activity-time { font-size:0.75rem; color:var(--text-muted); margin-top:4px; }
        .time-tracking { margin-top:10px; }
        .time-tracker { display:flex; gap:8px; }
        .time-tracker input { flex:1; padding:8px 12px; background:var(--dark-bg); border:1px solid var(--dark-border); border-radius:8px; color:var(--text-primary); font-size:0.85rem; }
        .time-log { margin-top:10px; }
        .time-log-item { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid var(--dark-border); font-size:0.85rem; color:var(--text-secondary); }
        .milestone-item { display:flex; align-items:center; gap:10px; padding:10px 0; border-bottom:1px solid var(--dark-border); }
        .milestone-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
        .milestone-text { font-size:0.85rem; color:var(--text-secondary); }
        .milestone-date { font-size:0.75rem; color:var(--text-muted); }
        .sidebar-right .quick-actions-list { display:flex; flex-direction:column; gap:8px; }
        .sidebar-right .quick-actions-list .btn { width:100%; text-align:center; }
        .collapsible-header { cursor:pointer; user-select:none; }
        .collapsible-header .chevron { transition:transform 0.3s ease; display:inline-block; }
        .collapsible-header .chevron.collapsed { transform:rotate(-90deg); }

        /* SECTION STYLES */
        .section {
            margin-bottom: 40px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--dark-border);
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .section-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            background: var(--primary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--dark-border);
        }
        
        .btn-secondary:hover {
            background: var(--text-muted);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        /* DOCUMENT VIEWER */
        .document-viewer {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid var(--dark-border);
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
        }
        
        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--dark-border);
        }
        
        .document-content {
            flex: 1;
            overflow: hidden;
        }
        
        /* DOCUMENTATION CARDS */
        .docs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* INTEGRATION CARDS */
        .integrations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .integration-card {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--dark-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .integration-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        
        .integration-card.linkedin {
            border-left: 4px solid #0077b5;
        }
        
        .integration-card.crm {
            border-left: 4px solid var(--warning);
        }
        
        .integration-card.agents {
            border-left: 4px solid var(--success);
        }
        
        .integration-card.voice {
            border-left: 4px solid #0a1d45;
        }
        
        .integration-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .integration-header i {
            font-size: 1.5rem;
        }
        
        .integration-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .integration-status.success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .integration-status.warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }
        
        .integration-status.info {
            background: rgba(6, 182, 212, 0.2);
            color: var(--info);
        }
        
        .integration-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .integration-countdown {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
            font-family: monospace;
        }
        
        .integration-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .integration-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .integration-features {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .feature-tag {
            display:inline-block;
            padding: 4px 10px;
            background: rgba(96,165,250,0.15);
            color: #60a5fa;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            margin: 3px 2px;
        }
        
        .integration-credentials {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }
        
        .credential-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-family: monospace;
        }
        
        .cred-label {
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .cred-value {
            color: var(--text-primary);
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .doc-card {
            background: var(--dark-card);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--dark-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .doc-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-color: var(--primary);
        }
        
        .doc-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .doc-title {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .doc-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .doc-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        /* CHARTS GRID */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--dark-border);
            transition: all 0.3s ease;
            height: 350px;
            position: relative;
        }
        
        .chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border-color: var(--primary);
        }
        
        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chart-container canvas {
            max-height: 280px;
        }
        
        /* Mobile responsive charts */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
                padding: 15px;
            }
            
            .chart-container canvas {
                max-height: 230px;
            }
        }
        
        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--dark-card);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid var(--dark-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .stat-card.success::before {
            background: var(--gradient-success);
        }
        
        .stat-card.warning::before {
            background: var(--gradient-warning);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 12px;
        }
        
        .stat-progress {
            height: 6px;
            background: var(--dark-border);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .stat-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 3px;
            transition: width 1s ease;
        }
        
        /* TASKS BOARD */
        .tasks-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .task-column {
            background: var(--dark-card);
            border-radius: 16px;
            border: 1px solid var(--dark-border);
            overflow: hidden;
        }
        
        .column-header {
            padding: 20px;
            background: var(--dark-border);
            border-bottom: 1px solid var(--dark-border);
            font-weight: 600;
            color: var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .task-count {
            background: var(--dark-bg);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .task-list {
            padding: 20px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .task-item {
            padding: 18px;
            margin-bottom: 12px;
            background: var(--dark-bg);
            border-radius: 12px;
            border: 1px solid var(--dark-border);
            display: flex;
            align-items: flex-start;
            gap: 15px;
            transition: all 0.2s ease;
            cursor: grab;
        }
        
        .task-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }
        
        .task-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--primary);
            border-radius: 6px;
            cursor: pointer;
            background: var(--dark-card);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .task-checkbox.checked {
            background: var(--primary);
        }
        
        .task-checkbox.checked::after {
            content: 'âœ“';
            color: white;
            font-weight: bold;
        }
        
        .task-content {
            flex: 1;
        }
        
        .task-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .task-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }
        
        .task-owner {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .owner-jim { background: rgba(59, 130, 246, 0.2); color: var(--primary); }
        .owner-nick { background: rgba(14, 165, 233, 0.2); color: var(--secondary); }
        .owner-ai { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .owner-both { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        
        .task-priority {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .priority-high { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .priority-medium { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .priority-low { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        
        /* INFO CARDS */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .info-card {
            background: var(--dark-card);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid var(--dark-border);
        }
        
        .info-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .info-card-title {
            font-size: 1.3rem;
            color: var(--primary);
        }
        
        /* RESPONSIVE */
        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: 250px 1fr 350px;
            }
        }
        
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar-left, .sidebar-right {
                display: none;
            }
            
            .nav-menu {
                display: flex;
                gap: 10px;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .nav-item {
                flex-shrink: 0;
                margin-bottom: 0;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 15px;
                padding: 20px;
                text-align: left;
            }
            
            .mobile-menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .header-content {
                flex: 1;
                min-width: 200px;
            }
            
            .header-content h1 {
                font-size: 1.5rem;
            }
            
            .header-stats {
                flex-wrap: wrap;
                justify-content: flex-end;
                gap: 10px;
            }
            
            .header-stat {
                padding: 8px 12px;
                min-width: 80px;
            }
            
            .header-stat-value {
                font-size: 1.3rem;
            }
            
            .header-stat-label {
                font-size: 0.75rem;
            }
            
            .breadcrumbs {
                padding: 10px 20px;
            }
            
            .tasks-board, .docs-grid, .info-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            /* Mobile Sidebar */
            .sidebar-left {
                position: fixed;
                top: 0;
                left: 0;
                width: 280px;
                height: 100vh;
                z-index: 10000;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                overflow-y: auto;
                padding-top: 60px;
            }
            
            .sidebar-left.mobile-open {
                transform: translateX(0);
            }
            
            .mobile-menu-close {
                display: block;
            }
            
            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                z-index: 9999;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            .sidebar-overlay.active {
                display: block;
                opacity: 1;
            }
            
            .content-area {
                max-height: calc(100vh - 220px);
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .task-meta {
                flex-direction: column;
                gap: 8px;
            }
            
            .section-title {
                font-size: 1.1rem;
                color: var(--text-primary);
            }
            
            .btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }
        }
        
        /* MOBILE RESPONSIVE - AGENT COORDINATION */
        @media (max-width: 768px) {
            /* Agent Task View */
            .agent-task-filters {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .agent-task-filter {
                padding: 6px 12px;
                font-size: 0.85rem;
                flex: 1;
                min-width: 80px;
                text-align: center;
            }
            
            .agent-task-grid {
                grid-template-columns: 1fr;
            }
            
            .agent-task-card {
                padding: 15px;
            }
            
            /* Priority Queue */
            .priority-queue-columns {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .priority-column {
                min-height: 150px;
            }
            
            /* Workload Panel */
            .workload-panel .quick-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .workload-panel .quick-action-btn {
                width: 100%;
                justify-content: center;
            }
            
            .balance-indicator {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            /* Agent Chat */
            .agent-chat-container {
                height: 400px;
            }
            
            .agent-chat-messages {
                padding: 15px;
            }
            
            .agent-chat-message {
                max-width: 90%;
                padding: 10px 14px;
            }
            
            .agent-chat-input-area {
                padding: 10px 15px;
            }
            
            .agent-chat-input {
                padding: 10px 12px;
                font-size: 16px; /* Prevent zoom on iOS */
            }
            
            /* Performance Charts */
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 280px;
                padding: 15px;
            }
            
            /* Agent Workload Items */
            .agent-workload-item {
                flex-direction: column;
                gap: 10px;
                padding: 12px;
            }
            
            .agent-workload-name {
                width: 100%;
                text-align: center;
            }
            
            .agent-workload-bar {
                width: 100%;
            }
            
            .agent-workload-value {
                width: 100%;
                text-align: center;
            }
            
            /* Section Headers */
            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .section-actions {
                width: 100%;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .section-actions .btn,
            .section-actions .agent-selector {
                flex: 1;
                min-width: 140px;
            }
            
            /* Agent Selectors */
            .agent-selector {
                width: 100%;
                min-width: unset;
            }
            
            /* Priority Task Items */
            .priority-task-item {
                padding: 10px;
            }
            
            /* Modal Adjustments */
            .modal-content {
                padding: 20px;
                margin: 20px;
                max-height: 85vh;
            }
            
            /* Notifications */
            .notification-container {
                left: 15px;
                right: 15px;
                top: 15px;
            }
            
            .notification {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            /* Smaller screens */
            .agent-chat-container {
                height: 350px;
            }
            
            .agent-task-header {
                flex-direction: column;
                gap: 8px;
            }
            
            .agent-task-priority {
                align-self: flex-start;
            }
            
            .agent-task-meta {
                flex-direction: column;
                gap: 5px;
            }
            
            .chart-container {
                height: 250px;
                padding: 12px;
            }
            
            .chart-title {
                font-size: 0.95rem;
            }
            
            .quick-actions {
                gap: 8px;
            }
            
            .quick-action-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }
            
            /* Sidebar nav improvements */
            .sidebar-nav {
                padding: 15px;
            }
            
            .nav-title {
                font-size: 0.75rem;
            }
            
            .nav-item {
                padding: 10px 12px;
            }
            
            /* Touch targets - minimum 44px */
            .btn, .nav-item, .agent-task-filter, .quick-action-btn {
                min-height: 44px;
            }
            
            /* Font size adjustments for readability */
            body {
                font-size: 15px;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .stat-label {
                font-size: 0.8rem;
            }
        }
        
        /* TOUCH DEVICE OPTIMIZATIONS */
        @media (hover: none) and (pointer: coarse) {
            /* Larger touch targets on touch devices */
            .btn, .nav-item, .agent-task-filter, .quick-action-btn, 
            .agent-chat-send, .priority-task-item {
                min-height: 44px;
            }
            
            /* Remove hover effects that don't work well on touch */
            .agent-task-card:hover,
            .priority-task-item:hover,
            .quick-action-btn:hover {
                transform: none;
            }
            
            /* Add active state for touch feedback */
            .btn:active, .nav-item:active, .agent-task-filter:active {
                opacity: 0.8;
                transform: scale(0.98);
            }
        }
        
        /* SAFARI iOS FIXES */
        @supports (-webkit-touch-callout: none) {
            /* Prevent iOS zoom on input focus */
            input, select, textarea {
                font-size: 16px;
            }
            
            /* Fix iOS scroll issues */
            .agent-chat-messages {
                -webkit-overflow-scrolling: touch;
            }
            
            /* Fix iOS rounded inputs */
            .agent-chat-input {
                border-radius: 8px;
            }
        }
        
        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* CUSTOM SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--dark-border);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 30px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            width: 90%;
            border: 1px solid var(--dark-border);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* FILE PREVIEW */
        .file-preview {
            background: var(--dark-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--dark-border);
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        /* AGENT REGISTRY SECTION */
        .agent-registry-section {
            margin-bottom: 40px;
        }

        .agent-registry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--dark-border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .agent-registry-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .agent-registry-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .agent-search-box {
            position: relative;
        }

        .agent-search-box input {
            padding: 10px 15px 10px 40px;
            border-radius: 10px;
            border: 1px solid var(--dark-border);
            background: var(--dark-bg);
            color: var(--text-primary);
            font-size: 0.95rem;
            width: 250px;
            transition: all 0.2s ease;
        }

        .agent-search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(10, 29, 69, 0.2);
        }

        .agent-search-box i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .agent-filter-buttons {
            display: flex;
            gap: 8px;
        }

        .agent-filter-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--dark-border);
            background: var(--dark-card);
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .agent-filter-btn:hover {
            background: var(--dark-border);
            color: var(--text-primary);
        }

        .agent-filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .agent-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .agent-card-item {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .agent-card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-color: var(--primary);
        }

        .agent-card-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .agent-card-item.status-active::before {
            background: linear-gradient(90deg, #22c55e, #16a34a);
        }

        .agent-card-item.status-available::before {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .agent-card-item.status-busy::before {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .agent-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .agent-card-info h3 {
            font-size: 1.15rem;
            color: var(--text-primary);
            margin-bottom: 6px;
            font-weight: 600;
        }

        .agent-card-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .agent-status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .agent-status-badge.active {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .agent-status-badge.available {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .agent-status-badge.busy {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .agent-card-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--dark-border);
        }

        .agent-stat {
            text-align: center;
        }

        .agent-stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .agent-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .agent-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--dark-border);
        }

        .agent-success-rate {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .agent-success-rate i {
            color: #22c55e;
        }

        .agent-view-details {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .agent-view-details:hover {
            background: var(--primary);
            color: white;
        }

        .agent-registry-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--dark-card);
            border-radius: 12px;
            border: 1px solid var(--dark-border);
        }

        .registry-summary-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .registry-summary-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .registry-summary-icon.total {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        .registry-summary-icon.active {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .registry-summary-icon.available {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .registry-summary-icon.busy {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .registry-summary-info {
            display: flex;
            flex-direction: column;
        }

        .registry-summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .registry-summary-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* AGENT DETAILS MODAL */
        .agent-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .agent-modal-overlay.active {
            display: flex;
        }

        .agent-modal-content {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid var(--dark-border);
            box-shadow: 0 25px 75px rgba(0,0,0,0.5);
        }

        .agent-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--dark-border);
        }

        .agent-modal-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .agent-modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.8rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .agent-modal-close:hover {
            background: var(--dark-border);
            color: var(--text-primary);
        }

        .agent-modal-body {
            color: var(--text-secondary);
        }

        .agent-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid var(--dark-border);
        }

        .agent-detail-row:last-child {
            border-bottom: none;
        }

        .agent-detail-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .agent-detail-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .agent-capabilities-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .agent-capability-tag {
            padding: 6px 12px;
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .agent-modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid var(--dark-border);
        }

        /* AGENT PROGRESS TRACKER */
        .agent-progress-tracker {
            margin: 15px 0;
        }
        
        .progress-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        
        .progress-label {
            flex: 1;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .progress-bar-small {
            width: 100px;
            height: 6px;
            background-color: var(--dark-border);
            border-radius: 3px;
            overflow: hidden;
            margin: 0 10px;
        }
        
        .progress-fill-small {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .progress-percent {
            width: 35px;
            text-align: right;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.8rem;
        }

        /* Risk Register */
        .risk-section { margin-top:30px; }
        .risk-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:20px; margin-top:15px; }
        .risk-card { background:var(--dark-card); padding:20px; border-radius:12px; border:1px solid var(--dark-border); }
        .risk-card.high { border-left:4px solid var(--danger); }
        .risk-card.medium { border-left:4px solid var(--warning); }
        .risk-card.low { border-left:4px solid #10b981; }
        .risk-title { font-size:1rem; font-weight:600; color:var(--text-primary); margin-bottom:10px; }
        .risk-meta { display:flex; gap:10px; margin-bottom:12px; flex-wrap:wrap; }
        .risk-probability, .risk-impact { padding:4px 12px; border-radius:20px; font-size:0.8rem; font-weight:600; }
        .risk-probability.high, .risk-impact.high { background:rgba(239,68,68,0.2); color:#ef4444; }
        .risk-probability.medium, .risk-impact.medium { background:rgba(245,158,11,0.2); color:#f59e0b; }
        .risk-probability.low, .risk-impact.low { background:rgba(16,185,129,0.2); color:#10b981; }
        .risk-mitigation { color:var(--text-secondary); font-size:0.9rem; line-height:1.5; }
        .risk-owner { margin-top:10px; color:#60a5fa; font-weight:600; font-size:0.85rem; }
    </style>
</head>
<body>
    <!-- AUTHENTICATION CHECK -->
    
    <div class="dashboard">
        <!-- HEADER -->
        <header class="header">
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle navigation menu">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-content">
                <h1>ðŸš€ Ascent XR Dashboard</h1>
                <div class="subtitle">Mission Control v19</div>
            </div>
            <div class="header-actions" style="display:flex; align-items:center; gap:15px;">
                <button class="btn" onclick="manualRefresh()" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:white; padding:8px 14px; border-radius:8px; cursor:pointer; font-size:0.85rem;">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <div id="lastRefreshTime" style="font-size:0.75rem; color:rgba(255,255,255,0.6);">Last refresh: just now</div>
                <div class="user-menu" id="headerUserMenu" style="display:flex; align-items:center; gap:10px; padding:8px 14px; background:rgba(255,255,255,0.1); border-radius:10px; border:1px solid rgba(255,255,255,0.2);">
                    <div style="width:32px; height:32px; border-radius:50%; background:linear-gradient(135deg, #ff6b00, #d97706); display:flex; align-items:center; justify-content:center; font-weight:700; font-size:0.8rem;">J</div>
                    <div>
                        <div style="font-size:0.85rem; font-weight:600;">Jim</div>
                        <div style="font-size:0.7rem; opacity:0.7;">CEO</div>
                    </div>
                </div>
            </div>
            <div class="header-stats">
                <div class="header-stat">
                    <div class="header-stat-value" id="daysRemaining">--</div>
                    <div class="header-stat-label">Days to Target</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value" id="revenuePipeline">$--K</div>
                    <div class="header-stat-label">Pipeline</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value" id="taskCompletion">--%</div>
                    <div class="header-stat-label">Tasks</div>
                </div>
            </div>
        </header>

        <!-- BREADCRUMBS -->
        <nav class="breadcrumbs" id="breadcrumbsNav">
            <div class="breadcrumb-container">
                <a href="#overview" class="breadcrumb-item" onclick="switchView('overview'); return false;">
                    <i class="fas fa-home"></i> Home
                </a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current" id="breadcrumbCurrent">Overview</span>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <div class="main-grid">
            <!-- SIDEBAR OVERLAY -->
            <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileMenu()"></div>
            
            <!-- LEFT SIDEBAR -->
            <aside class="sidebar-left" id="leftSidebar">
                <button class="mobile-menu-close" onclick="closeMobileMenu()" aria-label="Close menu">
                    <i class="fas fa-times"></i>
                </button>
                <nav class="nav-section">
                    <div class="nav-title">Navigation</div>
                    <ul class="nav-menu" id="mainNavMenu">
                        <li class="nav-item"><a href="#overview" class="nav-link active" data-view="overview" onclick="switchView('overview'); return false;"><i class="fas fa-home"></i> Overview</a></li>
                        <li class="nav-item"><a href="#tasks" class="nav-link" data-view="tasks" onclick="switchView('tasks'); return false;"><i class="fas fa-tasks"></i> Tasks</a></li>
                        <li class="nav-item"><a href="#analytics" class="nav-link" data-view="analytics" onclick="switchView('analytics'); return false;"><i class="fas fa-chart-line"></i> Analytics</a></li>
                        <li class="nav-item"><a href="#agents" class="nav-link" data-view="agents" onclick="switchView('agents'); return false;"><i class="fas fa-robot"></i> Agents</a></li>
                        <li class="nav-item"><a href="#documents" class="nav-link" data-view="documents" onclick="switchView('documents'); return false;"><i class="fas fa-folder-open"></i> Documents</a></li>
                        <li class="nav-item"><a href="#revenue" class="nav-link" data-view="revenue" onclick="switchView('revenue'); return false;"><i class="fas fa-dollar-sign"></i> Revenue</a></li>
                    </ul>
                </nav>
                <!-- Quick Links -->
                <div class="sidebar-section" style="padding:15px; border-top:1px solid var(--dark-border);">
                    <div class="sidebar-section-title" style="font-size:0.75rem; text-transform:uppercase; color:var(--text-muted); margin-bottom:10px; letter-spacing:1px;">Quick Links</div>
                    <a href="ASCENT_XR_ROI_TEMPLATE.html" target="_blank" style="display:block; padding:6px 10px; color:var(--text-secondary); text-decoration:none; font-size:0.85rem; border-radius:6px; transition:background 0.2s;" onmouseover="this.style.background='var(--dark-card)'" onmouseout="this.style.background='transparent'"><i class="fas fa-calculator" style="width:18px; margin-right:8px;"></i>ROI Template</a>
                    <a href="crm/" target="_blank" style="display:block; padding:6px 10px; color:var(--text-secondary); text-decoration:none; font-size:0.85rem; border-radius:6px; transition:background 0.2s;" onmouseover="this.style.background='var(--dark-card)'" onmouseout="this.style.background='transparent'"><i class="fas fa-database" style="width:18px; margin-right:8px;"></i>CRM</a>
                    <a href="linkedin_gallery.html" target="_blank" style="display:block; padding:6px 10px; color:var(--text-secondary); text-decoration:none; font-size:0.85rem; border-radius:6px; transition:background 0.2s;" onmouseover="this.style.background='var(--dark-card)'" onmouseout="this.style.background='transparent'"><i class="fab fa-linkedin" style="width:18px; margin-right:8px;"></i>LinkedIn Gallery</a>
                </div>
                <!-- Team Members -->
                <div class="sidebar-section" style="padding:15px; border-top:1px solid var(--dark-border);">
                    <div class="sidebar-section-title" style="font-size:0.75rem; text-transform:uppercase; color:var(--text-muted); margin-bottom:10px; letter-spacing:1px;">Team</div>
                    <div style="display:flex; align-items:center; gap:10px; padding:6px 0;">
                        <div style="width:28px; height:28px; border-radius:50%; background:linear-gradient(135deg, #ff6b00, #d97706); display:flex; align-items:center; justify-content:center; font-size:0.7rem; font-weight:700; color:white;">J</div>
                        <div><div style="font-size:0.85rem; color:var(--text-primary);">Jim</div><div style="font-size:0.7rem; color:var(--text-muted);">CEO</div></div>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px; padding:6px 0;">
                        <div style="width:28px; height:28px; border-radius:50%; background:linear-gradient(135deg, #3b82f6, #1d4ed8); display:flex; align-items:center; justify-content:center; font-size:0.7rem; font-weight:700; color:white;">N</div>
                        <div><div style="font-size:0.85rem; color:var(--text-primary);">Nick</div><div style="font-size:0.7rem; color:var(--text-muted);">CTO</div></div>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px; padding:6px 0;">
                        <div style="width:28px; height:28px; border-radius:50%; background:linear-gradient(135deg, #10b981, #0d9488); display:flex; align-items:center; justify-content:center; font-size:0.7rem; font-weight:700; color:white;">AI</div>
                        <div><div style="font-size:0.85rem; color:var(--text-primary);">AI Assistant</div><div style="font-size:0.7rem; color:var(--text-muted);">Agent</div></div>
                    </div>
                </div>
                <!-- Status Indicators -->
                <div class="sidebar-section" style="padding:15px; border-top:1px solid var(--dark-border);">
                    <div class="sidebar-section-title" style="font-size:0.75rem; text-transform:uppercase; color:var(--text-muted); margin-bottom:10px; letter-spacing:1px;">Status</div>
                    <div style="display:flex; align-items:center; gap:8px; padding:4px 0; font-size:0.85rem;">
                        <div style="width:8px; height:8px; border-radius:50%; background:#10b981;"></div>
                        <span style="color:var(--text-secondary);">Dashboard Active</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:8px; padding:4px 0; font-size:0.85rem;">
                        <div style="width:8px; height:8px; border-radius:50%; background:#3b82f6;"></div>
                        <span style="color:var(--text-secondary);">API Connected</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:8px; padding:4px 0; font-size:0.85rem;">
                        <div style="width:8px; height:8px; border-radius:50%; background:var(--warning);"></div>
                        <span style="color:var(--text-secondary);">LinkedIn Ready</span>
                    </div>
                </div>
            </aside>

            <!-- CENTER CONTENT -->
            <main class="content-area" id="mainContentArea">
                
                <!-- VIEW: OVERVIEW -->
                <div class="view-container active" id="overviewView">
                <!-- ROW 1: Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">$300K</div>
                        <div class="stat-label">Revenue Target</div>
                        <div class="stat-progress"><div class="stat-progress-bar" style="width: 4%"></div></div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-value">23</div>
                        <div class="stat-label">Tasks Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">3</div>
                        <div class="stat-label">LinkedIn Posts</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Active Prospects</div>
                    </div>
                </div>

                <!-- ROW 2: Revenue Forecasting Section -->
                <div class="section" id="revenueForecast">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-bullseye"></i> Revenue Forecast - $300K Target</div>
                        <div class="section-actions">
                            <span style="color: var(--text-secondary); font-size: 0.9rem;">Target Date: June 30, 2026</span>
                        </div>
                    </div>
                    
                    <!-- Revenue Target Tracking -->
                    <div style="background: var(--dark-card); border-radius: 16px; padding: 25px; margin-bottom: 25px; border: 1px solid var(--dark-border);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <div style="font-size: 1.3rem; font-weight: 600; color: var(--text-primary); margin-bottom: 5px;">Revenue Target Tracking</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">$300K by June 30, 2026</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--danger);">$288K</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">Remaining Gap</div>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem;">
                                <span style="color: var(--text-secondary);">Current: <strong style="color: var(--success);">$12K (4%)</strong></span>
                                <span style="color: var(--text-secondary);">Target: <strong style="color: var(--primary);">$300K</strong></span>
                            </div>
                            <div style="height: 12px; background: var(--dark-bg); border-radius: 6px; overflow: hidden; position: relative;">
                                <!-- Current Progress -->
                                <div style="width: 4%; height: 100%; background: linear-gradient(90deg, #22c55e, #16a34a); border-radius: 6px; transition: width 1s ease;"></div>
                                <!-- Milestones -->
                                <div style="position: absolute; top: 0; left: 25%; width: 2px; height: 100%; background: rgba(255,255,255,0.3);"></div>
                                <div style="position: absolute; top: 0; left: 50%; width: 2px; height: 100%; background: rgba(255,255,255,0.3);"></div>
                                <div style="position: absolute; top: 0; left: 75%; width: 2px; height: 100%; background: rgba(255,255,255,0.3);"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.75rem; color: var(--text-muted);">
                                <span>Start</span>
                                <span>$75K (25%)</span>
                                <span>$150K (50%)</span>
                                <span>$225K (75%)</span>
                                <span>$300K</span>
                            </div>
                        </div>
                        
                        <!-- Status Indicator -->
                        <div style="display: flex; align-items: center; gap: 10px; padding: 12px 15px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border-left: 4px solid var(--danger);">
                            <i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i>
                            <span style="color: var(--text-primary); font-size: 0.9rem;"><strong>At Risk:</strong> Need to accelerate to $48K/month average to hit target</span>
                        </div>
                    </div>
                    
                    <!-- Monthly Projections & Chart Grid -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                        <!-- Monthly Projections -->
                        <div style="background: var(--dark-card); border-radius: 16px; padding: 25px; border: 1px solid var(--dark-border);">
                            <div style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-calendar-alt" style="color: var(--primary);"></i> Monthly Projections
                            </div>
                            <div style="display: grid; gap: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: var(--dark-bg); border-radius: 8px; border-left: 4px solid var(--success);">
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">January</div>
                                        <div style="font-size: 0.8rem; color: var(--success);">âœ“ Actual</div>
                                    </div>
                                    <div style="font-size: 1.3rem; font-weight: bold; color: var(--success);">$12K</div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: var(--dark-bg); border-radius: 8px; border-left: 4px solid var(--warning);">
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">February</div>
                                        <div style="font-size: 0.8rem; color: var(--warning);">Projected</div>
                                    </div>
                                    <div style="font-size: 1.3rem; font-weight: bold; color: var(--text-primary);">$25K</div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: var(--dark-bg); border-radius: 8px; border-left: 4px solid var(--warning);">
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">March</div>
                                        <div style="font-size: 0.8rem; color: var(--warning);">Projected</div>
                                    </div>
                                    <div style="font-size: 1.3rem; font-weight: bold; color: var(--text-primary);">$45K</div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: var(--dark-bg); border-radius: 8px; border-left: 4px solid var(--warning);">
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">April</div>
                                        <div style="font-size: 0.8rem; color: var(--warning);">Projected</div>
                                    </div>
                                    <div style="font-size: 1.3rem; font-weight: bold; color: var(--text-primary);">$70K</div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: var(--dark-bg); border-radius: 8px; border-left: 4px solid var(--warning);">
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">May</div>
                                        <div style="font-size: 0.8rem; color: var(--warning);">Projected</div>
                                    </div>
                                    <div style="font-size: 1.3rem; font-weight: bold; color: var(--text-primary);">$90K</div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: var(--dark-bg); border-radius: 8px; border-left: 4px solid var(--primary);">
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">June</div>
                                        <div style="font-size: 0.8rem; color: var(--primary);">Target Hit</div>
                                    </div>
                                    <div style="font-size: 1.3rem; font-weight: bold; color: var(--primary);">$58K</div>
                                </div>
                            </div>
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--dark-border); text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--success);">$300K</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Total 6-Month Target</div>
                            </div>
                        </div>
                        
                        <!-- Revenue Trajectory Chart -->
                        <div style="background: var(--dark-card); border-radius: 16px; padding: 25px; border: 1px solid var(--dark-border);">
                            <div style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-chart-line" style="color: var(--primary);"></i> Revenue Trajectory
                            </div>
                            <div style="height: 320px; position: relative;">
                                <canvas id="revenueTrajectoryChart"></canvas>
                            </div>
                            <div style="display: flex; justify-content: center; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 12px; height: 12px; background: #22c55e; border-radius: 2px;"></div>
                                    <span style="font-size: 0.85rem; color: var(--text-secondary);">Actual</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 12px; height: 12px; background: #3b82f6; border-radius: 2px;"></div>
                                    <span style="font-size: 0.85rem; color: var(--text-secondary);">Projected</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 12px; height: 12px; background: rgba(148, 163, 184, 0.5); border-radius: 2px;"></div>
                                    <span style="font-size: 0.85rem; color: var(--text-secondary);">Target Line</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Key Metrics -->
                    <div style="background: var(--dark-card); border-radius: 16px; padding: 25px; border: 1px solid var(--dark-border);">
                        <div style="font-size: 1.1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-calculator" style="color: var(--primary);"></i> Key Metrics to Hit Target
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; text-align: center; border-top: 4px solid var(--primary);">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--primary); margin-bottom: 5px;">4.8</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">Deals/Month Needed</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Avg $12K deal size</div>
                            </div>
                            <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; text-align: center; border-top: 4px solid var(--warning);">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--warning); margin-bottom: 5px;">$12K</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">Avg Deal Size</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Target minimum</div>
                            </div>
                            <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; text-align: center; border-top: 4px solid var(--danger);">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--danger); margin-bottom: 5px;">3x</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">Pipeline Coverage</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Need $864K pipeline</div>
                            </div>
                            <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; text-align: center; border-top: 4px solid var(--success);">
                                <div style="font-size: 2.5rem; font-weight: bold; color: var(--success); margin-bottom: 5px;">29</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">Total Deals Needed</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">By June 30, 2026</div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid var(--primary);">
                            <div style="display: flex; align-items: flex-start; gap: 10px;">
                                <i class="fas fa-lightbulb" style="color: var(--primary); margin-top: 2px;"></i>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 5px;">Strategy Insight</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.5;">
                                        To close $288K in remaining revenue, focus on <strong>district licensing deals ($8K-$15K)</strong> 
                                        and <strong>custom experiences ($5K-$25K)</strong>. Maintain a 3x pipeline ratio by 
                                        generating ~15 qualified opportunities monthly. Prioritize expiring contracts and upsells 
                                        to existing clients for faster close cycles.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ROW 3: Analytics Charts -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-chart-pie"></i> Analytics Dashboard</div>
                        <div class="section-actions">
                            <button class="btn" onclick="refreshAnalytics()"><i class="fas fa-sync"></i> Refresh</button>
                            <button class="btn btn-secondary" onclick="exportAnalytics()"><i class="fas fa-download"></i> Export</button>
                        </div>
                    </div>
                    <div class="charts-grid">
                        <div class="chart-container">
                            <div class="chart-title">Revenue Pipeline Trend (6 Months)</div>
                            <canvas id="revenueTrendChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Agent Performance Radar (Top 5)</div>
                            <canvas id="agentPerformanceChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Task Distribution by Category</div>
                            <canvas id="taskDistributionChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Weekly Activity (Tasks vs Leads)</div>
                            <canvas id="weeklyActivityChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Completion Rate by Team</div>
                            <canvas id="completionRateChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Response Time Trends</div>
                            <canvas id="responseTimeChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Success Rate Trends</div>
                            <canvas id="successRateTrendChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Workload Distribution</div>
                            <canvas id="workloadDistributionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ROW 2.5: AGENT WORKLOAD PANEL -->
                <div class="workload-panel" style="background: var(--dark-card); border-radius: 16px; padding: 25px; margin-bottom: 30px; border: 1px solid var(--dark-border);">
                    <div class="section-header" style="margin-bottom: 20px;">
                        <div class="section-title"><i class="fas fa-tasks"></i> Agent Workload</div>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="color: var(--text-secondary);">11 Active</span>
                            <span style="color: var(--success);">6 Available</span>
                            <span style="color: var(--warning);">5 Busy</span>
                        </div>
                    </div>
                    <div class="workload-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                        <div class="agent-workload-card" style="background: var(--dark-bg); padding: 15px; border-radius: 12px; border-left: 4px solid var(--success);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>Dashboard UX Agent</strong>
                                <span style="color: var(--success); font-size: 0.85rem;">â— Active</span>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px;">BUILD: Mission Control v2.0</div>
                            <div style="display: flex; gap: 10px; font-size: 0.8rem;">
                                <span style="background: var(--primary); padding: 2px 8px; border-radius: 4px;">Due: Feb 5</span>
                                <span style="background: var(--warning); padding: 2px 8px; border-radius: 4px;">Progress: 85%</span>
                            </div>
                        </div>
                        <div class="agent-workload-card" style="background: var(--dark-bg); padding: 15px; border-radius: 12px; border-left: 4px solid var(--success);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>SDR Agent</strong>
                                <span style="color: var(--success); font-size: 0.85rem;">â— Active</span>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px;">LinkedIn Prospecting - Week 1</div>
                            <div style="display: flex; gap: 10px; font-size: 0.8rem;">
                                <span style="background: var(--primary); padding: 2px 8px; border-radius: 4px;">Due: Feb 7</span>
                                <span style="background: var(--success); padding: 2px 8px; border-radius: 4px;">Progress: 15%</span>
                            </div>
                        </div>
                        <div class="agent-workload-card" style="background: var(--dark-bg); padding: 15px; border-radius: 12px; border-left: 4px solid var(--success);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>CRM Sales Agent</strong>
                                <span style="color: var(--success); font-size: 0.85rem;">â— Active</span>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px;">HubSpot CRM Setup</div>
                            <div style="display: flex; gap: 10px; font-size: 0.8rem;">
                                <span style="background: var(--primary); padding: 2px 8px; border-radius: 4px;">Due: Feb 5</span>
                                <span style="background: var(--warning); padding: 2px 8px; border-radius: 4px;">Progress: 10%</span>
                            </div>
                        </div>
                        <div class="agent-workload-card" style="background: var(--dark-bg); padding: 15px; border-radius: 12px; border-left: 4px solid var(--warning);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>Content Creator</strong>
                                <span style="color: var(--warning); font-size: 0.85rem;">â— Active</span>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px;">LinkedIn Post for Feb 4</div>
                            <div style="display: flex; gap: 10px; font-size: 0.8rem;">
                                <span style="background: var(--primary); padding: 2px 8px; border-radius: 4px;">Due: Today</span>
                                <span style="background: var(--success); padding: 2px 8px; border-radius: 4px;">Progress: 60%</span>
                            </div>
                        </div>
                        <div class="agent-workload-card" style="background: var(--dark-bg); padding: 15px; border-radius: 12px; border-left: 4px solid var(--warning);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>Dashboard Enhancement</strong>
                                <span style="color: var(--warning); font-size: 0.85rem;">â— Active</span>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px;">Fix dashboard color scheme</div>
                            <div style="display: flex; gap: 10px; font-size: 0.8rem;">
                                <span style="background: var(--primary); padding: 2px 8px; border-radius: 4px;">Due: Today</span>
                                <span style="background: var(--success); padding: 2px 8px; border-radius: 4px;">Progress: 90%</span>
                            </div>
                        </div>
                        <div class="agent-workload-card" style="background: var(--dark-bg); padding: 15px; border-radius: 12px; border-left: 4px solid var(--danger);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>Coordination Dashboard</strong>
                                <span style="color: var(--danger); font-size: 0.85rem;">â— At Risk</span>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 8px;">Update agent coordination system</div>
                            <div style="display: flex; gap: 10px; font-size: 0.8rem;">
                                <span style="background: var(--danger); padding: 2px 8px; border-radius: 4px;">Due: Feb 3 (OVERDUE)</span>
                                <span style="background: var(--warning); padding: 2px 8px; border-radius: 4px;">Progress: 35%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ROW 3: Task Board (hidden but present for JS) -->
                <div id="overviewView" style="display:none;">
                    <div class="tasks-board">
                        <div class="task-column">
                            <h3>Jim's Tasks <span id="jimCount">0</span></h3>
                            <div id="jimTasks"></div>
                        </div>
                        <div class="task-column">
                            <h3>Nick's Tasks <span id="nickCount">0</span></h3>
                            <div id="nickTasks"></div>
                        </div>
                        <div class="task-column">
                            <h3>AI Tasks <span id="aiCount">0</span></h3>
                            <div id="aiTasks"></div>
                        </div>
                    </div>
                    <div id="detailedJimTasks" style="display:none;"></div>
                    <div id="detailedNickTasks" style="display:none;"></div>
                    <div id="detailedAiTasks" style="display:none;"></div>
                    <div id="detailedJointTasks" style="display:none;"></div>
                </div>

                <!-- FINANCIAL HEALTH SECTION -->
                <div class="financial-health-section" id="financialHealthSection" style="background: var(--dark-card); border-radius: 16px; padding: 25px; margin-bottom: 30px; border: 1px solid var(--dark-border); border-left: 4px solid var(--success);">
                    <div class="section-header" style="margin-bottom: 20px;">
                        <div class="section-title"><i class="fas fa-dollar-sign" style="color: var(--success);"></i> Financial Health</div>
                        <div style="display: flex; gap: 10px;">
                            <span style="background: var(--success); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">Q1 2026</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; border-left: 4px solid var(--success);">
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">MRR (Monthly Recurring Revenue)</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--success); margin-bottom: 5px;">$2,000</div>
                            <div style="font-size: 0.8rem; color: var(--success);">â†‘ 15% from last month</div>
                        </div>
                        <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; border-left: 4px solid var(--warning);">
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">CAC (Customer Acquisition Cost)</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--text-primary); margin-bottom: 5px;">$1,500</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">Target: &lt;$2,000</div>
                        </div>
                        <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; border-left: 4px solid var(--success);">
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">LTV (Lifetime Value)</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--success); margin-bottom: 5px;">$45,000</div>
                            <div style="font-size: 0.8rem; color: var(--success);">Based on 75% margin</div>
                        </div>
                        <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; border-left: 4px solid var(--success);">
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">LTV:CAC Ratio</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--success); margin-bottom: 5px;">30:1</div>
                            <div style="font-size: 0.8rem; color: var(--success);">Target: 3:1 âœ“</div>
                        </div>
                        <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; border-left: 4px solid var(--success);">
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;">Churn Rate</div>
                            <div style="font-size: 2rem; font-weight: bold; color: var(--success); margin-bottom: 5px;">0%</div>
                            <div style="font-size: 0.8rem; color: var(--success);">Target: &lt;5% âœ“</div>
                        </div>
                    </div>
                </div>

                <!-- SALES PIPELINE SECTION -->
                <div class="sales-pipeline-section" id="salesPipelineSection" style="background: var(--dark-card); border-radius: 16px; padding: 25px; margin-bottom: 30px; border: 1px solid var(--dark-border); border-left: 4px solid var(--info);">
                    <div class="section-header" style="margin-bottom: 20px;">
                        <div class="section-title"><i class="fas fa-funnel-dollar" style="color: var(--info);"></i> Sales Pipeline</div>
                        <div style="display: flex; gap: 15px;">
                            <div style="text-align: right;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--text-primary);">$45,000</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Pipeline</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--success);">20%</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Win Rate</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pipeline Funnel -->
                    <div style="margin-bottom: 25px;">
                        <div style="font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">Pipeline Stages</div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 100px; font-size: 0.85rem; color: var(--text-secondary);">Lead</div>
                                <div style="flex: 1; background: var(--dark-bg); height: 30px; border-radius: 6px; overflow: hidden;">
                                    <div style="width: 100%; height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%); display: flex; align-items: center; padding: 0 10px; font-size: 0.85rem; font-weight: 600;">12 deals | $120K</div>
                                </div>
                                <div style="width: 50px; text-align: right; font-size: 0.85rem; color: var(--text-secondary);">10%</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 100px; font-size: 0.85rem; color: var(--text-secondary);">MQL</div>
                                <div style="flex: 1; background: var(--dark-bg); height: 30px; border-radius: 6px; overflow: hidden;">
                                    <div style="width: 75%; height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%); display: flex; align-items: center; padding: 0 10px; font-size: 0.85rem; font-weight: 600;">9 deals | $85K</div>
                                </div>
                                <div style="width: 50px; text-align: right; font-size: 0.85rem; color: var(--text-secondary);">20%</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 100px; font-size: 0.85rem; color: var(--text-secondary);">SQL</div>
                                <div style="flex: 1; background: var(--dark-bg); height: 30px; border-radius: 6px; overflow: hidden;">
                                    <div style="width: 60%; height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%); display: flex; align-items: center; padding: 0 10px; font-size: 0.85rem; font-weight: 600;">6 deals | $60K</div>
                                </div>
                                <div style="width: 50px; text-align: right; font-size: 0.85rem; color: var(--text-secondary);">30%</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 100px; font-size: 0.85rem; color: var(--text-secondary);">Discovery</div>
                                <div style="flex: 1; background: var(--dark-bg); height: 30px; border-radius: 6px; overflow: hidden;">
                                    <div style="width: 45%; height: 100%; background: linear-gradient(90deg, var(--warning) 0%, var(--warning) 100%); display: flex; align-items: center; padding: 0 10px; font-size: 0.85rem; font-weight: 600;">4 deals | $45K</div>
                                </div>
                                <div style="width: 50px; text-align: right; font-size: 0.85rem; color: var(--text-secondary);">50%</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 100px; font-size: 0.85rem; color: var(--text-secondary);">Demo</div>
                                <div style="flex: 1; background: var(--dark-bg); height: 30px; border-radius: 6px; overflow: hidden;">
                                    <div style="width: 35%; height: 100%; background: linear-gradient(90deg, var(--warning) 0%, var(--warning) 100%); display: flex; align-items: center; padding: 0 10px; font-size: 0.85rem; font-weight: 600;">3 deals | $35K</div>
                                </div>
                                <div style="width: 50px; text-align: right; font-size: 0.85rem; color: var(--text-secondary);">60%</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 100px; font-size: 0.85rem; color: var(--text-secondary);">Proposal</div>
                                <div style="flex: 1; background: var(--dark-bg); height: 30px; border-radius: 6px; overflow: hidden;">
                                    <div style="width: 25%; height: 100%; background: linear-gradient(90deg, var(--success) 0%, var(--success) 100%); display: flex; align-items: center; padding: 0 10px; font-size: 0.85rem; font-weight: 600;">2 deals | $25K</div>
                                </div>
                                <div style="width: 50px; text-align: right; font-size: 0.85rem; color: var(--text-secondary);">70%</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 100px; font-size: 0.85rem; color: var(--text-secondary);">Negotiation</div>
                                <div style="flex: 1; background: var(--dark-bg); height: 30px; border-radius: 6px; overflow: hidden;">
                                    <div style="width: 15%; height: 100%; background: linear-gradient(90deg, var(--success) 0%, var(--success) 100%); display: flex; align-items: center; padding: 0 10px; font-size: 0.85rem; font-weight: 600;">1 deal | $15K</div>
                                </div>
                                <div style="width: 50px; text-align: right; font-size: 0.85rem; color: var(--text-secondary);">80%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Opportunities -->
                    <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px;">
                        <div style="font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">Top 5 Opportunities</div>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--dark-card); border-radius: 8px; border-left: 3px solid var(--success);">
                                <div>
                                    <div style="font-weight: 600;">Jefferson County Schools</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">Proposal Stage â€¢ 70% probability</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold; color: var(--success);">$15,000</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Close: Feb 15</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--dark-card); border-radius: 8px; border-left: 3px solid var(--success);">
                                <div>
                                    <div style="font-weight: 600;">Franklin Township</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">Demo Stage â€¢ 60% probability</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold; color: var(--success);">$10,000</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Close: Feb 20</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--dark-card); border-radius: 8px; border-left: 3px solid var(--warning);">
                                <div>
                                    <div style="font-weight: 600;">Oakwood District</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">Discovery Stage â€¢ 50% probability</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold; color: var(--warning);">$12,000</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Close: Mar 1</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--dark-card); border-radius: 8px; border-left: 3px solid var(--warning);">
                                <div>
                                    <div style="font-weight: 600;">Maple Valley Schools</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">SQL Stage â€¢ 30% probability</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold; color: var(--warning);">$8,000</div>
                                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Close: Mar 10</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SYSTEM INTEGRATIONS SECTION -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-puzzle-piece"></i> System Integrations</div>
                    </div>
                    <div class="integrations-grid">
                        <div class="integration-card">
                            <div class="integration-header">
                                <i class="fab fa-linkedin"></i>
                                <div class="integration-status success">LIVE</div>
                            </div>
                            <div class="integration-title">LinkedIn Campaign</div>
                            <div class="integration-description">3 posts scheduled</div>
                            <div class="integration-stats">
                                <div class="stat-item"><span class="stat-label">Posts Ready</span><span class="stat-value">3/3</span></div>
                                <div class="stat-item"><span class="stat-label">Images</span><span class="stat-value">3</span></div>
                            </div>
                        </div>
                        <div class="integration-card">
                            <div class="integration-header">
                                <i class="fas fa-database"></i>
                                <div class="integration-status success">CONNECTED</div>
                            </div>
                            <div class="integration-title">CRM System</div>
                            <div class="integration-description">Client management active</div>
                            <div class="integration-stats">
                                <div class="stat-item"><span class="stat-label">Contacts</span><span class="stat-value" id="integrationContacts">--</span></div>
                                <div class="stat-item"><span class="stat-label">Pipeline</span><span class="stat-value" id="integrationPipeline">--</span></div>
                            </div>
                        </div>
                        <div class="integration-card">
                            <div class="integration-header">
                                <i class="fas fa-robot"></i>
                                <div class="integration-status success">LIVE</div>
                            </div>
                            <div class="integration-title">Agent Progress</div>
                            <div class="integration-description">Real-time agent tracking</div>
                            <div class="agent-progress-tracker">
                                <div class="progress-item">
                                    <div class="progress-label">Backend</div>
                                    <div class="progress-bar-small"><div class="progress-fill-small" style="width:75%; background:var(--primary);"></div></div>
                                    <div class="progress-percent">75%</div>
                                </div>
                                <div class="progress-item">
                                    <div class="progress-label">QA</div>
                                    <div class="progress-bar-small"><div class="progress-fill-small" style="width:80%; background:var(--success);"></div></div>
                                    <div class="progress-percent">80%</div>
                                </div>
                                <div class="progress-item">
                                    <div class="progress-label">Deployment</div>
                                    <div class="progress-bar-small"><div class="progress-fill-small" style="width:60%; background:var(--warning);"></div></div>
                                    <div class="progress-percent">60%</div>
                                </div>
                            </div>
                        </div>
                        <div class="integration-card">
                            <div class="integration-header">
                                <i class="fas fa-server"></i>
                                <div class="integration-status success">HEALTHY</div>
                            </div>
                            <div class="integration-title">API Server</div>
                            <div class="integration-description">Backend services running</div>
                            <div class="integration-stats">
                                <div class="stat-item"><span class="stat-label">Uptime</span><span class="stat-value">99.7%</span></div>
                                <div class="stat-item"><span class="stat-label">Response</span><span class="stat-value">142ms</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LINKEDIN CAMPAIGN SECTION -->
                <div class="linkedin-campaign-section" id="linkedinCampaignSection" style="background: var(--dark-card); border-radius: 16px; padding: 25px; margin-bottom: 30px; border: 1px solid var(--dark-border); border-left: 4px solid #0077b5;">
                    <div class="section-header" style="margin-bottom: 20px;">
                        <div class="section-title"><i class="fab fa-linkedin" style="color: #0077b5;"></i> LinkedIn Campaign - Week 1</div>
                        <div style="display: flex; gap: 10px;">
                            <span style="background: var(--success); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">Active</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #0077b5; margin-bottom: 5px;">3</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Posts Scheduled</div>
                            <div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 5px;">Feb 3, 5, 7</div>
                        </div>
                        <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--success); margin-bottom: 5px;">0</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Posts Published</div>
                            <div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 5px;">Campaign starts tomorrow</div>
                        </div>
                        <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--warning); margin-bottom: 5px;">250</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Target Connections</div>
                            <div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 5px;">50/day x 5 days</div>
                        </div>
                        <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--info); margin-bottom: 5px;">10</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Qualified Leads Goal</div>
                            <div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 5px;">3 discovery calls</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--dark-bg); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <div style="font-weight: 600; margin-bottom: 15px; color: var(--text-primary);">ðŸ“… Posting Schedule</div>
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; align-items: center; gap: 15px; padding: 12px; background: var(--dark-card); border-radius: 8px; border-left: 3px solid var(--warning);">
                                <div style="background: var(--warning); color: white; padding: 8px 12px; border-radius: 6px; font-weight: 600; font-size: 0.85rem;">MON</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600;">Post 1: The Engagement Gap</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">8:30 AM EST â€¢ Food Web VR Experience</div>
                                </div>
                                <div style="color: var(--warning); font-size: 0.8rem; font-weight: 600;">TOMORROW</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; padding: 12px; background: var(--dark-card); border-radius: 8px; border-left: 3px solid var(--text-muted);">
                                <div style="background: var(--text-muted); color: white; padding: 8px 12px; border-radius: 6px; font-weight: 600; font-size: 0.85rem;">WED</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600;">Post 2: AI + Spatial Learning</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">11:30 AM EST â€¢ AI Demo Interface</div>
                                </div>
                                <div style="color: var(--text-muted); font-size: 0.8rem;">Feb 5</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; padding: 12px; background: var(--dark-card); border-radius: 8px; border-left: 3px solid var(--text-muted);">
                                <div style="background: var(--text-muted); color: white; padding: 8px 12px; border-radius: 6px; font-weight: 600; font-size: 0.85rem;">FRI</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600;">Post 3: Superintendent's Dilemma</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">3:30 PM EST â€¢ ROI Framework</div>
                                </div>
                                <div style="color: var(--text-muted); font-size: 0.8rem;">Feb 7</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="viewLinkedInDetails()" style="background: #0077b5; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <i class="fab fa-linkedin"></i> View Campaign Details
                        </button>
                        <button onclick="viewPostContent()" style="background: var(--dark-border); color: var(--text-primary); border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-file-alt"></i> View Post Content
                        </button>
                        <button onclick="trackEngagement()" style="background: var(--dark-border); color: var(--text-primary); border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-chart-line"></i> Track Engagement
                        </button>
                    </div>
                </div>

                <!-- AGENT REGISTRY SECTION -->
                <div class="agent-registry-section" id="agentRegistrySection">
                    <div class="agent-registry-header">
                        <div class="agent-registry-title">
                            <i class="fas fa-robot"></i> Agent Registry
                        </div>
                        <div class="agent-registry-controls">
                            <div class="agent-search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="agentSearchInput" placeholder="Search agents by name..." onkeyup="filterAgentCards()">
                            </div>
                            <div class="agent-filter-buttons">
                                <button class="agent-filter-btn active" data-filter="all" onclick="filterByStatus('all')">All</button>
                                <button class="agent-filter-btn" data-filter="active" onclick="filterByStatus('active')">Active</button>
                                <button class="agent-filter-btn" data-filter="available" onclick="filterByStatus('available')">Available</button>
                                <button class="agent-filter-btn" data-filter="busy" onclick="filterByStatus('busy')">Busy</button>
                            </div>
                        </div>
                    </div>

                    <!-- Registry Summary -->
                    <div class="agent-registry-summary" id="agentRegistrySummary">
                        <div class="registry-summary-item">
                            <div class="registry-summary-icon total">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="registry-summary-info">
                                <div class="registry-summary-value" id="summaryTotalAgents">22</div>
                                <div class="registry-summary-label">Total Agents</div>
                            </div>
                        </div>
                        <div class="registry-summary-item">
                            <div class="registry-summary-icon active">
                                <i class="fas fa-play-circle"></i>
                            </div>
                            <div class="registry-summary-info">
                                <div class="registry-summary-value" id="summaryActiveAgents">11</div>
                                <div class="registry-summary-label">Active</div>
                            </div>
                        </div>
                        <div class="registry-summary-item">
                            <div class="registry-summary-icon available">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="registry-summary-info">
                                <div class="registry-summary-value" id="summaryAvailableAgents">6</div>
                                <div class="registry-summary-label">Available</div>
                            </div>
                        </div>
                        <div class="registry-summary-item">
                            <div class="registry-summary-icon busy">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="registry-summary-info">
                                <div class="registry-summary-value" id="summaryBusyAgents">5</div>
                                <div class="registry-summary-label">Busy</div>
                            </div>
                        </div>
                    </div>

                    <!-- Agent Cards Grid -->
                    <div class="agent-cards-grid" id="agentCardsGrid">
                        <!-- Agent cards will be rendered here by JavaScript -->
                    </div>
                </div>

                <!-- Agent Details Modal -->
                <div class="agent-modal-overlay" id="agentDetailsModal">
                    <div class="agent-modal-content">
                        <div class="agent-modal-header">
                            <div class="agent-modal-title" id="modalAgentName">Agent Details</div>
                            <button class="agent-modal-close" onclick="closeAgentModal()">&times;</button>
                        </div>
                        <div class="agent-modal-body" id="modalAgentBody">
                            <!-- Modal content will be rendered here -->
                        </div>
                        <div class="agent-modal-actions">
                            <button class="btn" onclick="assignTaskToModalAgent()">
                                <i class="fas fa-plus"></i> Assign Task
                            </button>
                            <button class="btn btn-secondary" onclick="closeAgentModal()">Close</button>
                        </div>
                    </div>
                </div>

                <!-- RISK REGISTER SECTION -->
                <div class="section risk-section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-shield-alt"></i> Risk Register</div>
                    </div>
                    <div class="risk-grid">
                        <div class="risk-card high">
                            <div class="risk-title">School budget cycles delay decisions</div>
                            <div class="risk-meta">
                                <div class="risk-probability high">High Probability</div>
                                <div class="risk-impact high">High Impact</div>
                            </div>
                            <div class="risk-mitigation">Target districts with remaining FY funds; offer pilot pricing</div>
                            <div class="risk-owner">Owner: Jim</div>
                        </div>
                        <div class="risk-card medium">
                            <div class="risk-title">Custom projects take longer than expected</div>
                            <div class="risk-meta">
                                <div class="risk-probability medium">Medium Probability</div>
                                <div class="risk-impact medium">Medium Impact</div>
                            </div>
                            <div class="risk-mitigation">Create template workflows; collect 50% upfront</div>
                            <div class="risk-owner">Owner: Nick</div>
                        </div>
                        <div class="risk-card medium">
                            <div class="risk-title">Existing clients don't renew</div>
                            <div class="risk-meta">
                                <div class="risk-probability medium">Medium Probability</div>
                                <div class="risk-impact high">High Impact</div>
                            </div>
                            <div class="risk-mitigation">Proactive engagement; deliver new content weekly; ROI documentation</div>
                            <div class="risk-owner">Owner: Both</div>
                        </div>
                        <div class="risk-card low">
                            <div class="risk-title">LinkedIn outreach feels spammy</div>
                            <div class="risk-meta">
                                <div class="risk-probability medium">Medium Probability</div>
                                <div class="risk-impact low">Low Impact</div>
                            </div>
                            <div class="risk-mitigation">Lead with value; personalize messages; share useful content</div>
                            <div class="risk-owner">Owner: Jim</div>
                        </div>
                    </div>
                </div>

                <!-- DOCUMENTS VIEW SECTION -->
                <div id="documentsView" style="display:none;">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><i class="fas fa-folder-open"></i> Documents & Resources</div>
                            <div class="section-actions">
                                <button class="btn" onclick="refreshDocuments()"><i class="fas fa-sync"></i> Refresh</button>
                            </div>
                        </div>
                        
                        <!-- ROI Resources -->
                        <div class="docs-category" style="margin-bottom: 30px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-chart-pie" style="color: var(--success);"></i> ROI Resources
                            </h3>
                            <div class="docs-grid">
                                <div class="doc-card" onclick="openDocumentView('roi-template')">
                                    <div class="doc-title"><i class="fas fa-file-invoice-dollar"></i> ROI Template for School Districts</div>
                                    <div class="doc-description">Comprehensive ROI framework for demonstrating value to K-12 decision makers</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="openDocumentView('roi-calculator')">
                                    <div class="doc-title"><i class="fas fa-calculator"></i> ROI Calculator</div>
                                    <div class="doc-description">Interactive calculator for projecting savings and engagement metrics</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="openDocumentView('case-studies')">
                                    <div class="doc-title"><i class="fas fa-book-open"></i> Case Studies</div>
                                    <div class="doc-description">Success stories from Geo Community HS and other client implementations</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- LinkedIn Campaign -->
                        <div class="docs-category" style="margin-bottom: 30px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fab fa-linkedin" style="color: #0077b5;"></i> LinkedIn Campaign
                            </h3>
                            <div class="docs-grid">
                                <div class="doc-card" onclick="openDocumentView('linkedin-week1')">
                                    <div class="doc-title"><i class="fas fa-calendar-week"></i> Week 1 Post Content</div>
                                    <div class="doc-description">3 ready-to-post LinkedIn articles with engagement hooks and hashtags</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-copy"></i> Copy</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="openDocumentView('linkedin-week2')">
                                    <div class="doc-title"><i class="fas fa-calendar-week"></i> Week 2 Post Content</div>
                                    <div class="doc-description">Follow-up posts scheduled for Feb 10, 12, 14 with optimized timing</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-copy"></i> Copy</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="window.open('linkedin_gallery.html', '_blank')">
                                    <div class="doc-title"><i class="fas fa-images"></i> Image Assets</div>
                                    <div class="doc-description">LinkedIn post images, graphics, and visual content gallery</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-images"></i> Open Gallery</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="openDocumentView('linkedin-schedule')">
                                    <div class="doc-title"><i class="fas fa-clock"></i> Scheduling System</div>
                                    <div class="doc-description">Automated posting schedule and calendar integration setup</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-calendar"></i> Schedule</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Strategy Documents -->
                        <div class="docs-category" style="margin-bottom: 30px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-chess" style="color: var(--warning);"></i> Strategy Documents
                            </h3>
                            <div class="docs-grid">
                                <div class="doc-card" onclick="openDocumentView('q1-plan')">
                                    <div class="doc-title"><i class="fas fa-bullseye"></i> Q1 Marketing & Sales Plan</div>
                                    <div class="doc-description">Complete Q1 strategy targeting $300K revenue across 3 growth tracks</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="openDocumentView('linkedin-strategy')">
                                    <div class="doc-title"><i class="fab fa-linkedin"></i> LinkedIn Strategy</div>
                                    <div class="doc-description">Comprehensive LinkedIn content strategy and engagement framework</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="openDocumentView('agent-coordination')">
                                    <div class="doc-title"><i class="fas fa-robot"></i> Agent Coordination System</div>
                                    <div class="doc-description">Documentation for the multi-agent workflow and task management system</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="openDocumentView('crm-guide')">
                                    <div class="doc-title"><i class="fas fa-database"></i> CRM Setup Guide</div>
                                    <div class="doc-description">HubSpot CRM configuration guide for school relationship management</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Training Materials -->
                        <div class="docs-category" style="margin-bottom: 30px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-graduation-cap" style="color: var(--info);"></i> Training Materials
                            </h3>
                            <div class="docs-grid">
                                <div class="doc-card" onclick="openDocumentView('training-sdr')">
                                    <div class="doc-title"><i class="fas fa-user-tie"></i> SDR Agent Training</div>
                                    <div class="doc-description">Sales Development Representative training manual for prospecting and outreach</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="openDocumentView('training-crm')">
                                    <div class="doc-title"><i class="fas fa-handshake"></i> CRM Sales Training</div>
                                    <div class="doc-description">CRM & Sales Pipeline Agent training for deal tracking and forecasting</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                                <div class="doc-card" onclick="openDocumentView('training-cpa')">
                                    <div class="doc-title"><i class="fas fa-calculator"></i> Financial Agent (CPA) Training</div>
                                    <div class="doc-description">Financial planning, budgeting, and CPA-specific agent training materials</div>
                                    <div class="doc-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn btn-sm btn-secondary"><i class="fas fa-download"></i> Download</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TASKS VIEW SECTION -->
                <div id="tasksView" style="display:none;">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><i class="fas fa-tasks"></i> Task Management</div>
                            <div class="section-actions">
                                <button class="btn" onclick="addNewTask()"><i class="fas fa-plus"></i> Add Task</button>
                            </div>
                        </div>
                        <div class="tasks-board">
                            <div class="task-column">
                                <div class="column-header">Jim's Tasks <span class="task-count" id="tasksJimCount">3</span></div>
                                <div class="task-list" id="tasksJimList"></div>
                            </div>
                            <div class="task-column">
                                <div class="column-header">Nick's Tasks <span class="task-count" id="tasksNickCount">4</span></div>
                                <div class="task-list" id="tasksNickList"></div>
                            </div>
                            <div class="task-column">
                                <div class="column-header">AI Tasks <span class="task-count" id="tasksAiCount">5</span></div>
                                <div class="task-list" id="tasksAiList"></div>
                            </div>
                            <div class="task-column">
                                <div class="column-header">Joint Tasks <span class="task-count" id="tasksJointCount">3</span></div>
                                <div class="task-list" id="tasksJointList"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ANALYTICS VIEW SECTION -->
                <div id="analyticsView" style="display:none;">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><i class="fas fa-chart-line"></i> Analytics Dashboard</div>
                            <div class="section-actions">
                                <button class="btn" onclick="refreshAnalytics()"><i class="fas fa-sync"></i> Refresh</button>
                                <button class="btn btn-secondary" onclick="exportAnalytics()"><i class="fas fa-download"></i> Export</button>
                            </div>
                        </div>
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-title">Revenue Pipeline Trend (6 Months)</div>
                                <canvas id="analyticsRevenueChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Agent Performance Radar (Top 5)</div>
                                <canvas id="analyticsAgentChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Task Distribution by Category</div>
                                <canvas id="analyticsTaskChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Weekly Activity (Tasks vs Leads)</div>
                                <canvas id="analyticsActivityChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Revenue Pipeline by Product</div>
                                <canvas id="pipelineDoughnutChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Task Completion by Team Member</div>
                                <canvas id="teamCompletionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AGENTS VIEW SECTION -->
                <div id="agentsView" style="display:none;">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><i class="fas fa-robot"></i> Agent Management</div>
                            <div class="section-actions">
                                <button class="btn" onclick="refreshAgentData()"><i class="fas fa-sync"></i> Refresh</button>
                            </div>
                        </div>
                        <div id="agentsContainer">
                            <!-- Agent registry content will be cloned here -->
                        </div>
                    </div>

                    <!-- AGENT COORDINATION PANELS -->

                    <!-- 1. Agent Task Assignments Panel -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><i class="fas fa-user-astronaut"></i> Agent Task Assignments</div>
                            <div class="section-actions">
                                <select class="agent-selector" id="agentTaskFilter" onchange="filterAgentTasks()" style="padding:6px 12px; background:var(--dark-card); border:1px solid var(--dark-border); color:var(--text-primary); border-radius:8px; font-size:0.85rem;">
                                    <option value="all">All Agents</option>
                                    <optgroup label="Sales &amp; CRM">
                                        <option value="sdr_agent">SDR Agent</option>
                                        <option value="crm_sales_agent">CRM &amp; Sales Pipeline Agent</option>
                                    </optgroup>
                                    <optgroup label="Finance">
                                        <option value="financial_agent">Financial Agent (CPA)</option>
                                    </optgroup>
                                    <optgroup label="Content &amp; Marketing">
                                        <option value="content_creator">LinkedIn Execution Agent</option>
                                        <option value="ai_content">AI Content Generation Agent</option>
                                        <option value="email_automation">Email Automation Agent</option>
                                    </optgroup>
                                    <optgroup label="Design &amp; Development">
                                        <option value="designer">Branding &amp; Design Agent</option>
                                        <option value="developer">CRM Development Agent</option>
                                        <option value="dashboard_enhancement">Dashboard Enhancement Agent</option>
                                    </optgroup>
                                    <optgroup label="Analytics">
                                        <option value="analytics">Analytics &amp; Reporting Agent</option>
                                        <option value="market_research">Market Research Agent</option>
                                    </optgroup>
                                </select>
                                <button class="btn" onclick="autoAssignAllTasks()"><i class="fas fa-magic"></i> Auto-Assign</button>
                            </div>
                        </div>
                        <div class="agent-task-view">
                            <div class="agent-task-filters" style="display:flex; gap:8px; margin-bottom:15px; flex-wrap:wrap;">
                                <button class="agent-filter-btn active" onclick="filterTasksByPriority('all')">All</button>
                                <button class="agent-filter-btn" onclick="filterTasksByPriority('critical')">Critical</button>
                                <button class="agent-filter-btn" onclick="filterTasksByPriority('high')">High</button>
                                <button class="agent-filter-btn" onclick="filterTasksByPriority('medium')">Medium</button>
                                <button class="agent-filter-btn" onclick="filterTasksByPriority('low')">Low</button>
                            </div>
                            <div class="agent-task-grid" id="agentTaskGrid">
                                <!-- Tasks loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- 2. Priority Task Queue -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><i class="fas fa-sort-amount-down"></i> Priority Task Queue</div>
                            <div class="section-actions">
                                <button class="btn" onclick="refreshPriorityQueue()"><i class="fas fa-sync-alt"></i> Refresh</button>
                                <button class="btn btn-secondary" onclick="addPriorityTask()"><i class="fas fa-plus"></i> Add Task</button>
                            </div>
                        </div>
                        <div class="priority-queue">
                            <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:15px;" id="priorityQueueContainer">
                                <div class="priority-column" data-priority="critical" style="background:rgba(239,68,68,0.05); border:1px solid rgba(239,68,68,0.2); border-radius:10px; padding:15px;">
                                    <div style="font-weight:600; color:#ef4444; margin-bottom:10px; display:flex; justify-content:space-between;">
                                        <span><i class="fas fa-exclamation-circle"></i> Critical</span>
                                        <span class="task-count" id="criticalCount">0</span>
                                    </div>
                                    <div id="criticalTasks"></div>
                                </div>
                                <div class="priority-column" data-priority="high" style="background:rgba(245,158,11,0.05); border:1px solid rgba(245,158,11,0.2); border-radius:10px; padding:15px;">
                                    <div style="font-weight:600; color:#f59e0b; margin-bottom:10px; display:flex; justify-content:space-between;">
                                        <span><i class="fas fa-arrow-up"></i> High</span>
                                        <span class="task-count" id="highCount">0</span>
                                    </div>
                                    <div id="highTasks"></div>
                                </div>
                                <div class="priority-column" data-priority="medium" style="background:rgba(59,130,246,0.05); border:1px solid rgba(59,130,246,0.2); border-radius:10px; padding:15px;">
                                    <div style="font-weight:600; color:#3b82f6; margin-bottom:10px; display:flex; justify-content:space-between;">
                                        <span><i class="fas fa-minus"></i> Medium</span>
                                        <span class="task-count" id="mediumCount">0</span>
                                    </div>
                                    <div id="mediumTasks"></div>
                                </div>
                                <div class="priority-column" data-priority="low" style="background:rgba(16,185,129,0.05); border:1px solid rgba(16,185,129,0.2); border-radius:10px; padding:15px;">
                                    <div style="font-weight:600; color:#10b981; margin-bottom:10px; display:flex; justify-content:space-between;">
                                        <span><i class="fas fa-arrow-down"></i> Low</span>
                                        <span class="task-count" id="lowCount">0</span>
                                    </div>
                                    <div id="lowTasks"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Workload Balancing Panel -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><i class="fas fa-balance-scale"></i> Workload Balancing</div>
                            <div class="section-actions">
                                <button class="btn" onclick="analyzeWorkload()"><i class="fas fa-chart-pie"></i> Analyze</button>
                                <button class="btn" onclick="rebalanceWorkload()"><i class="fas fa-sync"></i> Rebalance</button>
                            </div>
                        </div>
                        <div class="workload-panel">
                            <div class="balance-indicator" id="balanceIndicator" style="display:flex; align-items:center; gap:15px; padding:15px; background:var(--dark-card); border-radius:10px; border:1px solid var(--dark-border); margin-bottom:15px;">
                                <i class="fas fa-check-circle" style="color:#10b981; font-size:1.5rem;"></i>
                                <div style="flex:1;">
                                    <div style="font-weight:600; color:var(--text-primary);">Workload Distribution</div>
                                    <div style="font-size:0.85rem; color:var(--text-secondary);">Optimal balance across agents</div>
                                </div>
                                <span style="padding:4px 12px; background:rgba(16,185,129,0.2); color:#10b981; border-radius:20px; font-size:0.8rem; font-weight:600;">OPTIMAL</span>
                            </div>
                            <div id="workloadChartContainer"></div>
                            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); gap:10px; margin-top:15px;">
                                <button class="btn btn-secondary" onclick="redistributeTasks()" style="font-size:0.85rem;"><i class="fas fa-random"></i> Redistribute</button>
                                <button class="btn btn-secondary" onclick="identifyBottlenecks()" style="font-size:0.85rem;"><i class="fas fa-search"></i> Find Bottlenecks</button>
                                <button class="btn btn-secondary" onclick="suggestReassignments()" style="font-size:0.85rem;"><i class="fas fa-lightbulb"></i> Suggestions</button>
                                <button class="btn btn-secondary" onclick="viewCapacityPlanning()" style="font-size:0.85rem;"><i class="fas fa-calendar-alt"></i> Capacity</button>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Agent Communication Hub -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><i class="fas fa-comments"></i> Agent Communication Hub</div>
                            <div class="section-actions">
                                <select id="chatAgentSelector" style="padding:6px 12px; background:var(--dark-card); border:1px solid var(--dark-border); color:var(--text-primary); border-radius:8px; font-size:0.85rem;">
                                    <option value="broadcast">Broadcast to All</option>
                                    <option value="sdr_agent">SDR Agent</option>
                                    <option value="crm_sales_agent">CRM Sales Agent</option>
                                    <option value="financial_agent">Financial Agent</option>
                                    <option value="content_creator">Content Creator</option>
                                    <option value="analytics">Analytics Agent</option>
                                </select>
                                <button class="btn btn-secondary" onclick="clearChatHistory()"><i class="fas fa-trash"></i> Clear</button>
                            </div>
                        </div>
                        <div style="background:var(--dark-card); border-radius:12px; border:1px solid var(--dark-border); overflow:hidden;">
                            <div style="padding:12px 15px; border-bottom:1px solid var(--dark-border); display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <div style="font-weight:600; font-size:0.9rem;"><i class="fas fa-robot"></i> Agent Team Chat</div>
                                    <div style="font-size:0.8rem; color:var(--text-secondary);">17 agents connected</div>
                                </div>
                                <div style="display:flex; gap:6px;">
                                    <span style="padding:2px 8px; background:rgba(16,185,129,0.2); color:#10b981; border-radius:10px; font-size:0.7rem;">8 Online</span>
                                    <span style="padding:2px 8px; background:rgba(245,158,11,0.2); color:#f59e0b; border-radius:10px; font-size:0.7rem;">3 Busy</span>
                                </div>
                            </div>
                            <div id="agentChatMessages" style="height:250px; overflow-y:auto; padding:15px;">
                                <div style="text-align:center; color:var(--text-muted); padding:20px; font-size:0.85rem;">No messages yet. Start a conversation with your agents.</div>
                            </div>
                            <div style="padding:12px; border-top:1px solid var(--dark-border); display:flex; gap:8px;">
                                <input type="text" id="agentChatInput" placeholder="Type a message to agents..." onkeypress="handleChatKeypress(event)" style="flex:1; padding:10px 14px; background:var(--dark-bg); border:1px solid var(--dark-border); border-radius:8px; color:var(--text-primary); font-size:0.9rem;">
                                <button class="btn" onclick="sendAgentChatMessage()" style="white-space:nowrap;"><i class="fas fa-paper-plane"></i> Send</button>
                            </div>
                        </div>
                    </div>

                    <!-- 5. Performance Charts Panel -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title"><i class="fas fa-chart-bar"></i> Agent Performance Analytics</div>
                            <div class="section-actions">
                                <select id="chartTimeRange" onchange="updatePerformanceCharts()" style="padding:6px 12px; background:var(--dark-card); border:1px solid var(--dark-border); color:var(--text-primary); border-radius:8px; font-size:0.85rem;">
                                    <option value="24h">Last 24 Hours</option>
                                    <option value="7d" selected>Last 7 Days</option>
                                    <option value="30d">Last 30 Days</option>
                                    <option value="all">All Time</option>
                                </select>
                                <button class="btn btn-secondary" onclick="exportChartData()"><i class="fas fa-download"></i> Export</button>
                            </div>
                        </div>
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-title"><i class="fas fa-tachometer-alt"></i> Task Completion Rate</div>
                                <canvas id="completionRateChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title"><i class="fas fa-clock"></i> Average Response Time</div>
                                <canvas id="responseTimeChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title"><i class="fas fa-trophy"></i> Success Rate Trends</div>
                                <canvas id="successRateTrendChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title"><i class="fas fa-tasks"></i> Workload Distribution</div>
                                <canvas id="workloadDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>

                </div>
            </main>

            <!-- RIGHT SIDEBAR -->
            <aside class="sidebar-right">

                <!-- 1. QUICK STATS -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-chart-bar"></i> Quick Stats</div>
                    </div>
                    <div class="quick-stats-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                        <div class="quick-stat">
                            <div class="quick-stat-value" style="color:#10b981;">11/22</div>
                            <div class="quick-stat-label">Active Agents</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" style="color:var(--primary);">23</div>
                            <div class="quick-stat-label">Tasks Today</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" style="color:var(--warning);">$285K</div>
                            <div class="quick-stat-label">Pipeline</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" style="color:var(--info);">94%</div>
                            <div class="quick-stat-label">Success Rate</div>
                        </div>
                    </div>
                </div>

                <!-- 2. NOTIFICATIONS -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-bell"></i> Notifications</div>
                    </div>
                    <ul class="notification-list">
                        <li class="notification-item success">
                            <strong>ROI Template Complete</strong>
                            <div class="activity-time">2 min ago</div>
                        </li>
                        <li class="notification-item info">
                            <strong>Weekly Review Scheduled</strong>
                            <div class="activity-time">1 hour ago</div>
                        </li>
                        <li class="notification-item warning">
                            <strong>CRM Task Due Soon</strong>
                            <div class="activity-time">5 hours ago</div>
                        </li>
                    </ul>
                </div>

                <!-- 3. TIME TRACKING -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-clock"></i> Time Tracking</div>
                    </div>
                    <div class="time-tracking">
                        <div class="time-tracker">
                            <input type="text" id="timeEntry" placeholder="What are you working on?">
                            <button class="btn" onclick="startTimer()" title="Start/Stop Timer"><i class="fas fa-play"></i></button>
                        </div>
                        <div class="time-log" id="timeLog">
                            <div class="time-log-item">
                                <span>ROI Template</span><span>1.5h</span>
                            </div>
                            <div class="time-log-item">
                                <span>Dashboard Dev</span><span>3.2h</span>
                            </div>
                            <div class="time-log-item">
                                <span>Client Outreach</span><span>2.0h</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. UPCOMING MILESTONES -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-flag"></i> Upcoming Milestones</div>
                    </div>
                    <div class="milestones-list">
                        <div class="milestone-item">
                            <div class="milestone-dot" style="background:#10b981;"></div>
                            <div>
                                <div class="milestone-text">LinkedIn Campaign Launch</div>
                                <div class="milestone-date">Feb 10</div>
                            </div>
                        </div>
                        <div class="milestone-item">
                            <div class="milestone-dot" style="background:#3b82f6;"></div>
                            <div>
                                <div class="milestone-text">CRM Setup Complete</div>
                                <div class="milestone-date">Feb 14</div>
                            </div>
                        </div>
                        <div class="milestone-item">
                            <div class="milestone-dot" style="background:#ff6b00;"></div>
                            <div>
                                <div class="milestone-text">Q1 Financial Review</div>
                                <div class="milestone-date">Mar 1</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. QUICK ACTIONS -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-bolt"></i> Quick Actions</div>
                    </div>
                    <div class="quick-actions-list" style="display:flex; flex-direction:column; gap:8px;">
                        <button class="btn" onclick="sendNotification()" style="width:100%;"><i class="fas fa-paper-plane"></i> Send Update</button>
                        <button class="btn" onclick="exportReport()" style="width:100%;"><i class="fas fa-file-export"></i> Export Report</button>
                        <button class="btn" onclick="scheduleMeeting()" style="width:100%;"><i class="fas fa-calendar-plus"></i> Schedule Meeting</button>
                    </div>
                </div>

                <!-- 6. LIVE UPDATES (collapsible) -->
                <div class="section">
                    <div class="section-header collapsible-header" onclick="toggleLiveUpdates()">
                        <div class="section-title"><i class="fas fa-rss"></i> Live Updates</div>
                        <span class="chevron" id="liveUpdatesChevron"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div id="liveUpdatesContent">
                        <ul id="activityFeed" style="list-style:none; padding:0;">
                            <li style="padding:12px; color:var(--text-secondary);">Loading...</li>
                        </ul>
                    </div>
                </div>

            </aside>
        </div>
    </div>

    <script>
// DATA DEFINITIONS
const AGENT_REGISTRY_URL = './agent_registry.json';
let agentRegistryData = null;
let lastRefreshTime = null;
let timerInterval = null;
let timerSeconds = 0;
const tasks = {
            jim: [
                { id: 1, title: "Complete client management CRM system", due: "Feb 7", priority: "high", completed: false, description: "Document all existing school relationships, usage data, renewal dates" },
                { id: 2, title: "Document all existing school relationships and status", due: "Feb 7", priority: "medium", completed: false, description: "Create comprehensive database of all current and past school relationships" },
                { id: 3, title: "Identify 5 WebXR experiences for tablet adaptation", due: "Feb 7", priority: "medium", completed: false, description: "Select best experiences for tablet optimization and document adaptation requirements" }
            ],
            nick: [
                { id: 4, title: "Continue food web experience development", due: "Ongoing", priority: "high", completed: false, description: "Finish food web ecosystem experience with predator-prey relationships" },
                { id: 5, title: "Continue co-signs project", due: "Ongoing", priority: "medium", completed: false, description: "Develop co-signs experience for spatial learning" },
                { id: 6, title: "Continue restorative model project", due: "Ongoing", priority: "medium", completed: false, description: "Build restorative justice model experience" },
                { id: 7, title: "Focus on creating reusable skills from existing experiences", due: "Feb 7", priority: "high", completed: false, description: "Document existing experiences as case studies and reusable components" }
            ],
            ai: [
                { id: 8, title: "Create ROI documentation template âœ…", due: "Feb 7 | Completed", priority: "high", completed: true, description: "ROI template for school districts with metrics and calculations" },
                { id: 9, title: "Draft LinkedIn post templates", due: "Feb 7", priority: "high", completed: false, description: "Create 3 LinkedIn post templates for engagement, AI, and superintendent topics" },
                { id: 10, title: "Research EdTech conferences for Q1-Q2", due: "Feb 7", priority: "medium", completed: false, description: "Identify relevant conferences and speaking opportunities" },
                { id: 11, title: "Set up weekly progress review system", due: "Feb 7", priority: "high", completed: false, description: "Create system for tracking weekly progress and metrics" },
                { id: 12, title: "Create custom experience proposal template", due: "Feb 7", priority: "medium", completed: false, description: "Template for proposing custom WebXR experiences to prospects" }
            ],
            joint: [
                { id: 13, title: "Schedule calls with Kevin (Geo) and Anita", due: "Feb 7", priority: "high", completed: false, description: "Schedule renewal and expansion discussions with existing clients" },
                { id: 14, title: "Draft first 3 LinkedIn posts", due: "Feb 7", priority: "medium", completed: false, description: "Create final versions of 3 LinkedIn posts for Week 1" },
                { id: 15, title: "Create target list of 10 potential clients", due: "Feb 7", priority: "medium", completed: false, description: "Identify 10 prospects for custom experience projects" }
            ]
        };
const documents = {
            dashboard: { title: "Ascent XR DASHBOARD", content: `Complete business dashboard and action plan`, file: "ASCENT_XR_DASHBOARD.html", realPath: "ASCENT_XR_DASHBOARD.html" },
            linkedin: { title: "LINKEDIN STRATEGY", content: `Complete content strategy with 3 draft posts`, file: "ASCENT_XR_LINKEDIN_STRATEGY.html", realPath: "ASCENT_XR_LINKEDIN_STRATEGY.html" },
            roi: { title: "ROI TEMPLATE", content: `ROI documentation template for school districts`, file: "ASCENT_XR_ROI_TEMPLATE.html", realPath: "ASCENT_XR_ROI_TEMPLATE.html" },
            constitution: { title: "ASCENT CONSTITUTION", content: `Ascent XR company constitution and principles`, file: "ASCENT_ASSISTANT_CONSTITUTION.html", realPath: "ASCENT_ASSISTANT_CONSTITUTION.html" },
            nick: { title: "NICK STATUS", content: `Latest status update from Nick (CTO)`, file: "NICK_STATUS.html", realPath: "NICK_STATUS.html" },
            schedule: { title: "LINKEDIN SCHEDULE", content: `LinkedIn posting schedule and automation`, file: "LINKEDIN_SCHEDULE.html", realPath: "LINKEDIN_SCHEDULE.html" },
            docs: { title: "ALL DOCUMENTS", content: `Complete documentation hub`, file: "ascent_dashboard_docs.html", realPath: "ascent_dashboard_docs.html" },
            gallery: { title: "LINKEDIN GALLERY", content: `LinkedIn post images gallery`, file: "linkedin_gallery.html", realPath: "linkedin_gallery.html" }
        };
let agentData = null;
let taskQueue = [];
let coordinationMetrics = {};
const agentMessages = [];
const liveUpdates = [
        { id: 1, type: 'success', message: 'Dashboard v16 deployed - cache fixes applied', time: 'Just now', icon: 'ðŸš€' },
        { id: 2, type: 'info', message: 'JavaScript errors fixed - renderLiveUpdates working', time: '2 minutes ago', icon: 'ðŸ›' },
        { id: 3, type: 'success', message: 'Business impact testing completed', time: '10 minutes ago', icon: 'âœ…' },
        { id: 4, type: 'success', message: '3 New Agents Activated: SDR, CRM Sales, Financial (CPA)', time: '20 minutes ago', icon: 'ðŸ¤–' },
        { id: 5, type: 'info', message: 'Authentication system active - 2 admins configured', time: '30 minutes ago', icon: 'ðŸ”' },
        { id: 6, type: 'success', message: '8 new analytics charts added to dashboard', time: '1 hour ago', icon: 'ðŸ“Š' },
        { id: 7, type: 'info', message: 'Tax documentation library created (CPA resources)', time: '2 hours ago', icon: 'ðŸ“š' },
        { id: 8, type: 'success', message: 'Q1 Marketing & Sales Plan completed ($300K target)', time: '3 hours ago', icon: 'ðŸŽ¯' },
        { id: 9, type: 'info', message: 'Week 2 LinkedIn posts ready (Feb 10, 12, 14)', time: '4 hours ago', icon: 'ðŸ“…' },
        { id: 10, type: 'warning', message: 'Purple colors removed from all LinkedIn specs', time: '5 hours ago', icon: 'ðŸŽ¨' }
    ];


// FUNCTION DEFINITIONS
function renderLiveUpdates() {
        const feed = document.getElementById('activityFeed');
        if (!feed) {
            console.warn('âš ï¸ renderLiveUpdates: activityFeed not found');
            return;
        }
        
        if (liveUpdates.length === 0) {
            feed.innerHTML = `
                <li style="padding: 20px; text-align: center; color: var(--text-secondary);">
                    <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; display: block; opacity: 0.5;"></i>
                    No updates yet
                </li>
            `;
            return;
        }
        
        const borderColors = {
            success: '#22c55e',
            info: '#3b82f6',
            warning: '#f59e0b',
            error: '#ef4444'
        };
        
        feed.innerHTML = liveUpdates.map(update => `
            <li style="padding: 12px; margin-bottom: 8px; background: var(--dark-card); border-radius: 8px; border-left: 4px solid ${borderColors[update.type] || '#3b82f6'};">
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <span style="font-size: 1.3rem; flex-shrink: 0;">${update.icon}</span>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px; line-height: 1.4;">${update.message}</div>
                        <div style="font-size: 0.8rem; color: #64748b; display: flex; align-items: center; gap: 6px;">
                            <i class="far fa-clock" style="font-size: 0.75rem;"></i>
                            ${update.time}
                        </div>
                    </div>
                </div>
            </li>
        `).join('');
    }


function toggleLiveUpdates() {
        const content = document.getElementById('liveUpdatesContent');
        const chevron = document.getElementById('liveUpdatesChevron');

        if (!content) {
            console.warn('toggleLiveUpdates: liveUpdatesContent not found');
            return;
        }

        if (content.style.display === 'none') {
            content.style.display = 'block';
            if (chevron) chevron.classList.remove('collapsed');
        } else {
            content.style.display = 'none';
            if (chevron) chevron.classList.add('collapsed');
        }
    }


function addLiveUpdate(type, message, icon = 'ðŸ“¢') {
        const newUpdate = {
            id: Date.now(),
            type: type,
            message: message,
            time: 'Just now',
            icon: icon
        };
        
        liveUpdates.unshift(newUpdate);
        if (liveUpdates.length > 20) liveUpdates.pop();
        
        liveUpdates.forEach((update, index) => {
            if (index === 0) update.time = 'Just now';
            else if (index === 1) update.time = '1 minute ago';
            else if (index < 5) update.time = `${index} minutes ago`;
            else if (index < 15) update.time = `${Math.floor(index / 5)} hours ago`;
            else update.time = 'Today';
        });
        
        renderLiveUpdates();
    }


function renderAllTasks() {
            // Overview board tasks
            renderTaskColumn('jimTasks', tasks.jim, 3);
            renderTaskColumn('nickTasks', tasks.nick, 4);
            renderTaskColumn('aiTasks', tasks.ai, 5);
            
            // Detailed tasks
            renderDetailedTasks('detailedJimTasks', tasks.jim);
            renderDetailedTasks('detailedNickTasks', tasks.nick);
            renderDetailedTasks('detailedAiTasks', tasks.ai);
            renderDetailedTasks('detailedJointTasks', tasks.joint);
            
            // Update counts (with null checks)
            const jimCount = document.getElementById('jimCount');
            const nickCount = document.getElementById('nickCount');
            const aiCount = document.getElementById('aiCount');
            if (jimCount) jimCount.textContent = tasks.jim.length;
            if (nickCount) nickCount.textContent = tasks.nick.length;
            if (aiCount) aiCount.textContent = tasks.ai.length;
        }


function renderTaskColumn(containerId, taskList, limit = 3) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.warn(`âš ï¸ renderTaskColumn: Container '${containerId}' not found`);
                return;
            }
            container.innerHTML = '';
            
            const displayTasks = taskList.slice(0, limit);
            
            displayTasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item fade-in';
                taskItem.innerHTML = `
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" 
                         onclick="toggleTask(${task.id}, this)">
                    </div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span><i class="far fa-calendar"></i> ${task.due}</span>
                            <span class="task-priority priority-${task.priority}">${task.priority}</span>
                        </div>
                    </div>
                `;
                container.appendChild(taskItem);
            });
        }


function renderDetailedTasks(containerId, taskList) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.warn(`âš ï¸ renderDetailedTasks: Container '${containerId}' not found`);
                return;
            }
            container.innerHTML = '';
            
            taskList.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item fade-in';
                taskItem.innerHTML = `
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" 
                         onclick="toggleTask(${task.id}, this)">
                    </div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description" style="font-size: 0.9rem; color: var(--text-secondary); margin: 5px 0; line-height: 1.4;">${task.description}</div>
                        <div class="task-meta">
                            <span><i class="far fa-calendar"></i> ${task.due}</span>
                            <span class="task-priority priority-${task.priority}">${task.priority}</span>
                            <span style="color: ${task.completed ? 'var(--success)' : 'var(--warning)'}">
                                <i class="fas fa-${task.completed ? 'check-circle' : 'clock'}"></i> ${task.completed ? 'Completed' : 'Pending'}
                            </span>
                        </div>
                    </div>
                `;
                container.appendChild(taskItem);
            });
        }


function toggleTask(taskId, checkbox) {
            // Find task in all arrays
            let task = null;
            let category = null;
            
            for (const [cat, taskList] of Object.entries(tasks)) {
                const found = taskList.find(t => t.id === taskId);
                if (found) {
                    task = found;
                    category = cat;
                    break;
                }
            }
            
            if (task) {
                task.completed = !task.completed;
                checkbox.classList.toggle('checked');
                
                // Update notification
                addNotification(
                    task.completed ? 'success' : 'info',
                    task.completed ? 
                        `âœ… Task Completed: "${task.title}"` :
                        `ðŸ”„ Task Reopened: "${task.title}"`
                );
                
                updateStats();
                renderAllTasks();
            }
        }


function updateStats() {
            // Calculate completion rate
            let totalTasks = 0;
            let completedTasks = 0;
            
            try {
                for (const taskList of Object.values(tasks)) {
                    if (taskList && Array.isArray(taskList)) {
                        totalTasks += taskList.length;
                        completedTasks += taskList.filter(t => t && t.completed).length;
                    }
                }
            } catch (error) {
                console.error('âŒ Error calculating stats:', error);
                return;
            }
            
            if (totalTasks === 0) return;
            
            const completionRate = Math.round((completedTasks / totalTasks) * 100);
            
            // Update display (with null checks)
            const taskCompletionEl = document.getElementById('taskCompletion');
            const statCardValue = document.querySelector('.stat-card:nth-child(2) .stat-value');
            const statProgressBar = document.querySelector('.stat-card:nth-child(2) .stat-progress-bar');
            
            if (taskCompletionEl) taskCompletionEl.textContent = `${completionRate}%`;
            if (statCardValue) statCardValue.textContent = `${totalTasks}`;
            if (statProgressBar) statProgressBar.style.width = `${completionRate}%`;
            
            // Update progress bars
            try {
                const progressBars = document.querySelectorAll('.stat-progress-bar');
                if (progressBars && progressBars[1]) {
                    progressBars[1].style.width = `${completionRate}%`;
                }
            } catch (error) {
                console.warn('âš ï¸ Error updating progress bars:', error);
            }
        }


function setupNavigation() {
            try {
                // View navigation links
                const navLinks = document.querySelectorAll('.nav-link[data-view]');
                if (navLinks) {
                    navLinks.forEach(link => {
                        if (link) {
                            link.addEventListener('click', function(e) {
                                e.preventDefault();
                                
                                // Update active state
                                try {
                                    document.querySelectorAll('.nav-link[data-view]').forEach(l => {
                                        if (l) l.classList.remove('active');
                                    });
                                } catch (error) {
                                    console.warn('âš ï¸ Error removing active state:', error);
                                }
                                this.classList.add('active');
                                
                                // Switch view
                                const view = this.dataset.view;
                                if (view) switchView(view);
                            });
                        }
                    });
                }
                
                // Document navigation links
                const docLinks = document.querySelectorAll('.nav-link.document-link');
                if (docLinks) {
                    docLinks.forEach(link => {
                        if (link) {
                            link.addEventListener('click', function(e) {
                                e.preventDefault();
                                
                                // Update active state
                                try {
                                    document.querySelectorAll('.nav-link').forEach(l => {
                                        if (l) l.classList.remove('active');
                                    });
                                } catch (error) {
                                    console.warn('âš ï¸ Error removing active state:', error);
                                }
                                this.classList.add('active');
                                
                                // Load document
                                const docKey = this.dataset.doc;
                                if (docKey) openDocument(docKey, e);
                            });
                        }
                    });
                }
            } catch (error) {
                console.error('âŒ Error in setupNavigation:', error);
            }
        }


function switchView(view) {
            // Clear any document viewer
            try {
                const contentArea = document.querySelector('.content-area');
                if (contentArea) {
                    const documentViewer = contentArea.querySelector('.document-viewer');
                    if (documentViewer) {
                        documentViewer.remove();
                    }
                }
            } catch (error) {
                console.warn('âš ï¸ Error clearing document viewer:', error);
            }
            
            // Hide all main sections in content area
            const sectionsToHide = [
                'stats-grid',
                'section',  // Analytics section with charts
                'workload-panel',
                'linkedin-campaign-section',
                'agent-registry-section',
                'overviewView',
                'documentsView',
                'tasksView',
                'analyticsView',
                'agentsView'
            ];
            
            sectionsToHide.forEach(selector => {
                const elements = document.querySelectorAll(`.${selector}, #${selector}`);
                elements.forEach(el => {
                    if (el) el.style.display = 'none';
                });
            });
            
            // Show selected view
            const viewElement = document.getElementById(`${view}View`);
            if (viewElement) {
                viewElement.style.display = 'block';
                
                // Load view-specific content
                switch(view) {
                    case 'documents':
                        loadDocumentsView();
                        break;
                    case 'tasks':
                        loadTasksView();
                        break;
                    case 'analytics':
                        loadAnalyticsView();
                        break;
                    case 'agents':
                        loadAgentsView();
                        break;
                    case 'overview':
                        loadOverviewView();
                        break;
                }
            } else {
                console.warn(`âš ï¸ switchView: View '${view}View' not found`);
            }
        }

function updateNavActive(linkElement) {
            // Update active state on nav links
            document.querySelectorAll('.nav-link').forEach(l => {
                l.classList.remove('active');
            });
            linkElement.classList.add('active');
        }

function loadOverviewView() {
            // Show overview sections
            const sections = [
                '.stats-grid',
                '.workload-panel',
                '.linkedin-campaign-section',
                '.agent-registry-section'
            ];
            sections.forEach(selector => {
                const el = document.querySelector(selector);
                if (el) el.style.display = '';
            });
        }

function loadTasksView() {
            const view = document.getElementById('tasksView');
            if (view) {
                view.style.display = 'block';
                // Populate task lists
                renderTaskList('tasksJimList', tasks.jim);
                renderTaskList('tasksNickList', tasks.nick);
                renderTaskList('tasksAiList', tasks.ai);
                renderTaskList('tasksJointList', tasks.joint);
            }
        }

function renderTaskList(containerId, taskList) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = taskList.map(task => `
                <div class="task-item fade-in">
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${task.id}, this)"></div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span><i class="far fa-calendar"></i> ${task.due}</span>
                            <span class="task-priority priority-${task.priority}">${task.priority}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

function loadAnalyticsView() {
            const view = document.getElementById('analyticsView');
            if (view) {
                view.style.display = 'block';
                // Initialize analytics charts
                initAnalyticsCharts();
            }
        }

function initAnalyticsCharts() {
            // Analytics view charts
            const charts = ['analyticsRevenueChart', 'analyticsAgentChart', 'analyticsTaskChart', 'analyticsActivityChart'];
            charts.forEach(id => {
                const ctx = document.getElementById(id);
                if (ctx && !ctx.chart) {
                    // Initialize charts if not already done
                    initPerformanceCharts();
                }
            });
        }

function loadAgentsView() {
            const view = document.getElementById('agentsView');
            if (view) {
                view.style.display = 'block';
                // Clone agent registry content
                const container = document.getElementById('agentsContainer');
                const registry = document.getElementById('agentRegistrySection');
                if (container && registry) {
                    container.innerHTML = registry.innerHTML;
                }
            }
        }

function loadDocumentsView() {
            const view = document.getElementById('documentsView');
            if (view) {
                view.style.display = 'block';
            }
        }

function openDocumentView(docId) {
            const documentMap = {
                'roi-template': { title: 'ROI Template for School Districts', file: 'ASCENT_XR_ROI_TEMPLATE.html' },
                'roi-calculator': { title: 'ROI Calculator', file: 'roi_calculator.html' },
                'case-studies': { title: 'Case Studies', file: 'case_studies.html' },
                'linkedin-week1': { title: 'Week 1 LinkedIn Content', file: 'linkedin_week1.html' },
                'linkedin-week2': { title: 'Week 2 LinkedIn Content', file: 'linkedin_week2.html' },
                'linkedin-schedule': { title: 'LinkedIn Scheduling System', file: 'LINKEDIN_SCHEDULE.html' },
                'q1-plan': { title: 'Q1 Marketing & Sales Plan', file: 'Q1_MARKETING_SALES_PLAN.html' },
                'linkedin-strategy': { title: 'LinkedIn Strategy', file: 'ASCENT_XR_LINKEDIN_STRATEGY.html' },
                'agent-coordination': { title: 'Agent Coordination System', file: 'agent_coordination_system.html' },
                'crm-guide': { title: 'CRM Setup Guide', file: 'crm_setup_guide.html' },
                'training-sdr': { title: 'SDR Agent Training', file: 'agents/training/SDR_AGENT_TRAINING.md' },
                'training-crm': { title: 'CRM Sales Training', file: 'agents/training/CRM_SALES_AGENT_TRAINING.md' },
                'training-cpa': { title: 'Financial Agent (CPA) Training', file: 'agents/training/FINANCIAL_AGENT_TRAINING.md' }
            };
            
            const doc = documentMap[docId];
            if (!doc) {
                showModal(`<h3>Document Not Found</h3><p>The document "${docId}" is not available.</p>`);
                return;
            }
            
            // Show document in modal
            const content = `
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-file-alt" style="font-size: 4rem; color: var(--primary); margin-bottom: 20px;"></i>
                    <h3>${doc.title}</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 30px;">Opening ${doc.file}...</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <a href="${doc.file}" target="_blank" class="btn"><i class="fas fa-external-link-alt"></i> Open in New Tab</a>
                        <button class="btn btn-secondary" onclick="closeModal()"><i class="fas fa-times"></i> Close</button>
                    </div>
                </div>
            `;
            showModal(content);
        }

function refreshDocuments() {
            addNotification('success', 'ðŸ“ Documents refreshed');
        }


function openDocument(docKey, e) {
            const doc = documents[docKey];
            if (!doc) {
                console.warn(`âš ï¸ openDocument: Document '${docKey}' not found`);
                return;
            }
            
            // Hide current content
            const contentArea = document.querySelector('.content-area');
            if (!contentArea) {
                console.error('âŒ openDocument: Content area not found');
                return;
            }
            contentArea.innerHTML = '';
            
            // Create document container
            const docContainer = document.createElement('div');
            docContainer.className = 'document-viewer';
            docContainer.innerHTML = `
                <div class="document-header">
                    <button class="btn btn-secondary" onclick="switchView('overview')">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </button>
                    <h2 style="margin: 0; color: var(--primary);">${doc.title}</h2>
                </div>
                <div class="document-content">
                    <iframe src="${doc.file}" style="width: 100%; height: calc(100vh - 200px); border: none; border-radius: 12px;"></iframe>
                </div>
            `;
            
            contentArea.appendChild(docContainer);
            
            // Update active nav state
            if (e && e.target) {
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                e.target.classList.add('active');
            }
        }


function closeModal() {
            const modal = document.getElementById('documentModal');
            if (modal) modal.style.display = 'none';
        }


function showModal(content) {
            const modal = document.getElementById('documentModal');
            const modalBody = document.getElementById('modalBody');
            if (modal && modalBody) {
                modalBody.innerHTML = content;
                modal.style.display = 'flex';
            }
        }


async function simulateFileLoad(filename) {
            try {
                // Try to fetch actual file content
                const response = await fetch(`/api/documents/${filename}`);
                
                if (response.ok) {
                    return await response.text();
                } else {
                    // Fallback: check if file exists in workspace and serve it
                    const fallbackFiles = {
                        "ASCENT_XR_DASHBOARD.html": `<iframe src="ASCENT_XR_DASHBOARD.html" style="width: 100%; height: 500px; border: none; border-radius: 8px;"></iframe>`,
                        "ASCENT_XR_LINKEDIN_STRATEGY.html": `<iframe src="ASCENT_XR_LINKEDIN_STRATEGY.html" style="width: 100%; height: 500px; border: none; border-radius: 8px;"></iframe>`,
                        "ASCENT_XR_ROI_TEMPLATE.html": `<iframe src="ASCENT_XR_ROI_TEMPLATE.html" style="width: 100%; height: 500px; border: none; border-radius: 8px;"></iframe>`,
                        "ASCENT_ASSISTANT_CONSTITUTION.html": `<iframe src="ASCENT_ASSISTANT_CONSTITUTION.html" style="width: 100%; height: 500px; border: none; border-radius: 8px;"></iframe>`,
                        "NICK_STATUS.html": `<iframe src="NICK_STATUS.html" style="width: 100%; height: 500px; border: none; border-radius: 8px;"></iframe>`,
                        "LINKEDIN_SCHEDULE.html": `<iframe src="LINKEDIN_SCHEDULE.html" style="width: 100%; height: 500px; border: none; border-radius: 8px;"></iframe>`,
                        "ascent_dashboard_docs.html": `<iframe src="ascent_dashboard_docs.html" style="width: 100%; height: 500px; border: none; border-radius: 8px;"></iframe>`,
                        "linkedin_gallery.html": `<iframe src="linkedin_gallery.html" style="width: 100%; height: 500px; border: none; border-radius: 8px;"></iframe>`
                    };
                    
                    if (fallbackFiles[filename]) {
                        return fallbackFiles[filename];
                    } else {
                        return `File "${filename}" not found.\n\nAvailable HTML documents:\n- ASCENT_XR_DASHBOARD.html\n- ASCENT_XR_LINKEDIN_STRATEGY.html\n- ASCENT_XR_ROI_TEMPLATE.html\n- ASCENT_ASSISTANT_CONSTITUTION.html\n- NICK_STATUS.html\n- LINKEDIN_SCHEDULE.html\n- ascent_dashboard_docs.html\n- linkedin_gallery.html\n\n**Note:** All documents are now available as HTML files with working links.`;
                    }
                }
            } catch (error) {
                return `Error loading ${filename}: ${error.message}\n\nThis dashboard is running locally. To access actual files, we need:\n1. Backend API server\n2. File serving endpoint\n3. Authentication system`;
            }
        }


function loadDocumentsView() {
            const container = document.getElementById('documentsView');
            container.innerHTML = `
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-folder-open"></i> All Documentation</div>
                        <div class="section-actions">
                            <button class="btn" onclick="exportAllDocs()"><i class="fas fa-download"></i> Export All</button>
                            <button class="btn btn-secondary" onclick="refreshDocs()"><i class="fas fa-sync"></i> Refresh</button>
                        </div>
                    </div>
                    <div class="docs-grid">
                        ${Object.entries(documents).map(([key, doc]) => `
                            <div class="doc-card" onclick="openDocument('${key}')">
                                <div class="doc-title"><i class="fas fa-file-alt"></i> ${doc.title}</div>
                                <div class="doc-description">Click to view full document content and details.</div>
                                <div class="doc-meta">
                                    <span><i class="fas fa-file"></i> ${doc.file}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }


function loadRevenueView() {
            const container = document.getElementById('revenueView');
            container.innerHTML = `
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fas fa-chart-line"></i> Revenue Pipeline</div>
                        <div class="section-actions">
                            <button class="btn" onclick="updatePipeline()"><i class="fas fa-sync"></i> Update</button>
                            <button class="btn btn-secondary" onclick="exportPipeline()"><i class="fas fa-file-export"></i> Export</button>
                        </div>
                    </div>
                    <div class="info-grid">
                        <div class="info-card">
                            <div class="info-card-header">
                                <i class="fas fa-school" style="color: var(--primary);"></i>
                                <div class="info-card-title">Track 1: District Licensing</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Target:</span>
                                    <span style="color: var(--primary); font-weight: 600;">5-10 districts by June</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Revenue Potential:</span>
                                    <span style="color: var(--success); font-weight: 600;">$48K-$150K</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Status:</span>
                                    <span style="color: var(--warning);">Planning phase</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-card-header">
                                <i class="fas fa-cube" style="color: var(--secondary);"></i>
                                <div class="info-card-title">Track 2: Custom Experiences</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Target:</span>
                                    <span style="color: var(--primary); font-weight: 600;">5-10 projects by June</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Revenue Potential:</span>
                                    <span style="color: var(--success); font-weight: 600;">$25K-$75K</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Status:</span>
                                    <span style="color: var(--warning);">Prospect identification</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-card-header">
                                <i class="fas fa-robot" style="color: var(--danger);"></i>
                                <div class="info-card-title">Track 3: AI Lesson Generation</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Target:</span>
                                    <span style="color: var(--primary); font-weight: 600;">Launch pilot in March</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Revenue Potential:</span>
                                    <span style="color: var(--success); font-weight: 600;">$15K-$50K</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Status:</span>
                                    <span style="color: var(--warning);">Development planning</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }


function loadLinkedInView() {
            const container = document.getElementById('linkedinView');
            container.innerHTML = `
                <div class="section">
                    <div class="section-header">
                        <div class="section-title"><i class="fab fa-linkedin"></i> LinkedIn Strategy - Week 1</div>
                        <div class="section-actions">
                            <a href="linkedin_gallery.html" target="_blank" class="btn" style="color: white; text-decoration: none;"><i class="fas fa-eye"></i> View Gallery</a>
                            <button class="btn" onclick="postToLinkedIn()"><i class="fas fa-paper-plane"></i> Schedule Posts</button>
                            <button class="btn btn-secondary" onclick="openDocument('schedule')"><i class="fas fa-calendar"></i> View Schedule</button>
                        </div>
                    </div>
                    
                    <!-- EMBEDDED LINKEDIN GALLERY IFRAME -->
                    <div class="info-card" style="grid-column: 1 / -1; padding: 0; overflow: hidden;">
                        <iframe src="/dev/linkedin_gallery.html" style="width: 100%; height: 400px; border: none; border-radius: 12px;"></iframe>
                        <div style="padding: 15px; border-top: 1px solid var(--dark-border);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>Ready for Launch:</strong> 3 posts with images uploaded
                                </div>
                                <div>
                                    <a href="linkedin_gallery.html" target="_blank" style="color: var(--primary); text-decoration: none; font-weight: 600;">
                                        Open Full Gallery â†’
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- QUICK STATS -->
                    <div class="info-grid" style="margin-top: 20px;">
                            <div class="info-card-header">
                                <i class="fas fa-video" style="color: var(--primary);"></i>
                                <div class="info-card-title">Post 1: The Engagement Gap</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <div style="margin-bottom: 10px; font-weight: 600; color: var(--text-primary);">Monday, Feb 3 â€¢ 8:30 AM EST</div>
                                <div style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5;">
                                    Traditional worksheets vs. immersive experiences - which would your students choose? We're seeing 300%+ engagement increases...
                                </div>
                                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                    <span style="background: var(--dark-border); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">#EdTech</span>
                                    <span style="background: var(--dark-border); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">#K12</span>
                                    <span style="background: var(--dark-border); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">#SpatialLearning</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-card-header">
                                <i class="fas fa-image" style="color: var(--secondary);"></i>
                                <div class="info-card-title">Post 2: AI + Spatial Learning</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <div style="margin-bottom: 10px; font-weight: 600; color: var(--text-primary);">Wednesday, Feb 5 â€¢ 11:30 AM EST</div>
                                <div style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5;">
                                    Teachers spend 7+ hours weekly creating supplemental materials. What if AI could generate immersive lessons in minutes?
                                </div>
                                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                    <span style="background: var(--dark-border); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">#AI</span>
                                    <span style="background: var(--dark-border); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">#EdTech</span>
                                    <span style="background: var(--dark-border); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">#TeacherTools</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-card-header">
                                <i class="fas fa-chart-bar" style="color: var(--success);"></i>
                                <div class="info-card-title">Post 3: Superintendent's Dilemma</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <div style="margin-bottom: 10px; font-weight: 600; color: var(--text-primary);">Friday, Feb 7 â€¢ 3:30 PM EST</div>
                                <div style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5;">
                                    To my 250+ superintendent connections: You're constantly balancing innovation with budget constraints...
                                </div>
                                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                    <span style="background: var(--dark-border); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">#Leadership</span>
                                    <span style="background: var(--dark-border); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">#K12Leadership</span>
                                    <span style="background: var(--dark-border); padding: 3px 8px; border-radius: 12px; font-size: 0.8rem;">#SchoolAdministration</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }


function startTimer() {
            const entry = document.getElementById('timeEntry').value;
            if (!entry) {
                alert('Please enter what you\'re working on');
                return;
            }
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            timerSeconds = 0;
            timerInterval = setInterval(() => {
                timerSeconds++;
                document.querySelector('.btn i.fa-play').className = 'fas fa-stop';
            }, 1000);
            
            addNotification('info', `â±ï¸ Started timer for: "${entry}"`);
        }


function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                const hours = (timerSeconds / 3600).toFixed(1);
                const entry = document.getElementById('timeEntry').value;
                
                if (hours > 0) {
                    const timeLog = document.querySelector('.time-log');
                    const logItem = document.createElement('div');
                    logItem.className = 'time-log-item';
                    logItem.innerHTML = `<span>${entry}</span><span>${hours}h</span>`;
                    timeLog.prepend(logItem);
                    
                    document.getElementById('timeEntry').value = '';
                    document.querySelector('.btn i.fa-stop').className = 'fas fa-play';
                    
                    addNotification('success', `âœ… Logged ${hours} hours for: "${entry}"`);
                }
            }
        }


function addNotification(type, message) {
            const notificationList = document.querySelector('.notification-list');
            const notificationItem = document.createElement('li');
            notificationItem.className = `notification-item ${type}`;
            notificationItem.innerHTML = `
                <strong>${message}</strong>
                <div class="activity-time">Just now</div>
            `;
            
            notificationList.prepend(notificationItem);
            
            // Limit to 4 notifications
            if (notificationList.children.length > 4) {
                notificationList.removeChild(notificationList.lastChild);
            }
        }


function sendUpdate(recipient) {
            const message = prompt(`Enter update to send to ${recipient}:`);
            if (message) {
                addNotification('info', `ðŸ“¤ Update sent to ${recipient}: "${message}"`);
            }
        }


function exportReport() {
            addNotification('success', 'ðŸ“Š Weekly report exported successfully');
        }


function scheduleMeeting() {
            const date = prompt('Enter meeting date and time (e.g., Feb 5 2:00 PM):');
            if (date) {
                addNotification('success', `ðŸ“… Meeting scheduled for ${date}`);
            }
        }


function sendNotification() {
            const message = prompt('Enter update message to send:');
            if (message) {
                addNotification('info', `ðŸ“¤ Update sent: "${message}"`);
            }
        }


function markTaskComplete() {
            const taskId = prompt('Enter task ID to mark complete:');
            if (taskId) {
                // Find and mark task
                for (const taskList of Object.values(tasks)) {
                    const task = taskList.find(t => t.id == taskId);
                    if (task) {
                        task.completed = true;
                        addNotification('success', `âœ… Marked task ${taskId} as complete`);
                        updateStats();
                        renderAllTasks();
                        return;
                    }
                }
                addNotification('warning', `âš ï¸ Task ${taskId} not found`);
            }
        }


function exportAllDocs() {
            addNotification('success', 'ðŸ“š All documents exported as ZIP file');
        }


function postToLinkedIn() {
            addNotification('success', 'ðŸ“± LinkedIn posts scheduled successfully');
        }


function refreshIntegrations() {
            const countdownElement = document.getElementById('linkedinCountdown');
            if (countdownElement) {
                // Feb 3, 8:30 AM EST = 13:30 UTC
                const postTime = new Date('2026-02-03T13:30:00Z');
                const now = new Date();
                const diff = postTime - now;
                
                if (diff > 0) {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    if (days > 0) {
                        countdownElement.textContent = `${days}d ${hours}h ${minutes}m`;
                    } else {
                        countdownElement.textContent = `${hours}h ${minutes}m ${seconds}s`;
                    }
                } else {
                    countdownElement.textContent = 'LIVE NOW!';
                    countdownElement.style.color = 'var(--success)';
                }
            }
            
            // Update CRM status
            const crmStatus = document.querySelector('.integration-card.crm .integration-status');
            if (crmStatus) {
                crmStatus.textContent = 'CONNECTED';
                crmStatus.className = 'integration-status success';
            }
            
            // Update agent count
            const agentCount = document.querySelector('.integration-card.agents .stat-item:nth-child(1) .stat-value');
            if (agentCount) {
                agentCount.textContent = '14';
            }
            
            // Update image preview if modal exists
            const modalImages = document.querySelectorAll('.post-preview-image');
            if (modalImages.length > 0) {
                updateImagePreviews();
            }
        }


function previewLinkedInPosts() {
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
            modal.style.zIndex = '10000';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div style="background: var(--dark-card); padding: 30px; border-radius: 20px; max-width: 500px; width: 90%;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: var(--primary);">LinkedIn Posts Preview</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">Ã—</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Post 1: The Engagement Gap</h4>
                        <div style="background: var(--dark-bg); padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Feb 3, 8:30 AM EST</div>
                            <div style="color: var(--text-primary); margin: 10px 0;">Traditional learning vs spatial learning - which engages students more?</div>
                            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                <span style="background: rgba(37, 99, 235, 0.2); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">#EdTech</span>
                                <span style="background: rgba(37, 99, 235, 0.2); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">#K12</span>
                                <span style="background: rgba(37, 99, 235, 0.2); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">#SpatialLearning</span>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Post 2: AI + Spatial Learning</h4>
                        <div style="background: var(--dark-bg); padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Feb 5, 11:30 AM EST</div>
                            <div style="color: var(--text-primary); margin: 10px 0;">AI generating 3D educational content - saving teachers hours of prep time.</div>
                            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                <span style="background: rgba(37, 99, 235, 0.2); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">#AI</span>
                                <span style="background: rgba(37, 99, 235, 0.2); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">#EdTech</span>
                                <span style="background: rgba(37, 99, 235, 0.2); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">#TeacherTools</span>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--text-primary); margin-bottom: 10px;">Post 3: Superintendent's Dilemma</h4>
                        <div style="background: var(--dark-bg); padding: 15px; border-radius: 10px;">
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Feb 7, 3:30 PM EST</div>
                            <div style="color: var(--text-primary); margin: 10px 0;">ROI framework for superintendents - 4 quadrants of measurable impact.</div>
                            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                <span style="background: rgba(37, 99, 235, 0.2); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">#Leadership</span>
                                <span style="background: rgba(37, 99, 235, 0.2); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">#K12Leadership</span>
                                <span style="background: rgba(37, 99, 235, 0.2); color: var(--primary); padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">#EdTech</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="postToLinkedIn()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">Schedule All Posts</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }


function testCRMConnection() {
            const statusElement = document.querySelector('.integration-card.crm .integration-status');
            if (statusElement) {
                statusElement.textContent = 'TESTING...';
                statusElement.className = 'integration-status info';
                
                setTimeout(() => {
                    statusElement.textContent = 'CONNECTED';
                    statusElement.className = 'integration-status success';
                    
                    // Show success notification
                    const notification = document.createElement('div');
                    notification.style.position = 'fixed';
                    notification.style.top = '20px';
                    notification.style.right = '20px';
                    notification.style.backgroundColor = 'var(--success)';
                    notification.style.color = 'white';
                    notification.style.padding = '15px';
                    notification.style.borderRadius = '8px';
                    notification.style.zIndex = '10000';
                    notification.textContent = 'âœ… CRM connection successful!';
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                }, 1500);
            }
        }


function viewAgentRegistry() {
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
            modal.style.zIndex = '10000';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div style="background: var(--dark-card); padding: 30px; border-radius: 20px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: var(--primary);">Agent Team Registry</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">Ã—</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: var(--dark-bg); padding: 15px; border-radius: 10px;">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 5px;">Main Agent</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Coordination & Project Management</div>
                            <div style="margin-top: 10px; color: var(--success); font-size: 0.85rem;">âœ… Active</div>
                        </div>
                        
                        <div style="background: var(--dark-bg); padding: 15px; border-radius: 10px;">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 5px;">LinkedIn Execution</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Content Creation & Scheduling</div>
                            <div style="margin-top: 10px; color: var(--success); font-size: 0.85rem;">âœ… Completed Week 1</div>
                        </div>
                        
                        <div style="background: var(--dark-bg); padding: 15px; border-radius: 10px;">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 5px;">CRM Development</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">School Relationship Management</div>
                            <div style="margin-top: 10px; color: var(--success); font-size: 0.85rem;">âœ… Interface Built</div>
                        </div>
                        
                        <div style="background: var(--dark-bg); padding: 15px; border-radius: 10px;">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 5px;">Branding & Design</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Visual Assets & Consistency</div>
                            <div style="margin-top: 10px; color: var(--success); font-size: 0.85rem;">âœ… Style Guide Complete</div>
                        </div>
                        
                        <div style="background: var(--dark-bg); padding: 15px; border-radius: 10px;">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 5px;">AI Content Generation</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Blogs, Case Studies, Social Media</div>
                            <div style="margin-top: 10px; color: var(--success); font-size: 0.85rem;">âœ… Templates Ready</div>
                        </div>
                        
                        <div style="background: var(--dark-bg); padding: 15px; border-radius: 10px;">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 5px;">Analytics & Reporting</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Performance Tracking & Metrics</div>
                            <div style="margin-top: 10px; color: var(--success); font-size: 0.85rem;">âœ… System Created</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; color: var(--text-muted); font-size: 0.9rem;">
                        14 total agents | Last updated: Just now
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }


function testVoiceInterface() {
            // Create voice test interface
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
            modal.style.zIndex = '10000';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div style="background: var(--dark-card); padding: 30px; border-radius: 20px; max-width: 400px; width: 90%; text-align: center;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #132e5e;">Samantha Voice Test</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">Ã—</button>
                    </div>
                    
                    <div style="color: var(--text-secondary); margin-bottom: 30px;">
                        <i class="fas fa-microphone" style="font-size: 3rem; color: #132e5e; margin-bottom: 20px;"></i>
                        <p>Samantha voice interface <span style="color: #ff6b00;">âœ… Demo Active</span></p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Voice demo shows interface. TTS available via OpenClaw when connected.</p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="playTestMessage('Welcome to Ascent XR! I\\'m Samantha, your magical assistant.')" style="background: #132e5e; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Test Greeting</button>
                        <button onclick="playTestMessage('Your LinkedIn posts are ready for Monday launch! Three images generated, scheduling complete.')" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Test Update</button>
                    </div>
                    <div style="margin-top: 15px; padding: 10px; background: rgba(14, 165, 233, 0.1); border-radius: 8px; font-size: 0.85rem;">
                        <i class="fas fa-info-circle" style="color: #132e5e; margin-right: 5px;"></i>
                        <strong>Note:</strong> Voice demo shows interface. Actual TTS requires OpenClaw connection.
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Function to play test message
            window.playTestMessage = function(text) {
                const ttsEvent = new CustomEvent('ttsRequest', { detail: { text: text } });
                window.dispatchEvent(ttsEvent);
                
                const messageDiv = document.createElement('div');
                messageDiv.style.position = 'fixed';
                messageDiv.style.bottom = '20px';
                messageDiv.style.left = '50%';
                messageDiv.style.transform = 'translateX(-50%)';
                messageDiv.style.backgroundColor = 'var(--primary)';
                messageDiv.style.color = 'white';
                messageDiv.style.padding = '10px 20px';
                messageDiv.style.borderRadius = '8px';
                messageDiv.style.zIndex = '10001';
                messageDiv.textContent = 'Playing: ' + text.substring(0, 50) + '...';
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.remove();
                }, 3000);
            };
        }


function manualRefresh() {
    addNotification('info', 'Refreshing dashboard data...');
    loadAllMetrics && loadAllMetrics();
    loadAgentRegistry && loadAgentRegistry();
    updateLastRefreshTime();
    setTimeout(() => addNotification('success', 'Dashboard data refreshed'), 1000);
}

function updateLastRefreshTime() {
    const el = document.getElementById('lastRefreshTime');
    if (el) {
        const now = new Date();
        el.textContent = 'Last refresh: ' + now.toLocaleTimeString();
    }
    lastRefreshTime = Date.now();
}

function getDashboardStatus() {
    return {
        registryLoaded: !!agentRegistryData,
        lastRefresh: lastRefreshTime ? new Date(lastRefreshTime).toISOString() : null,
        agentCount: agentRegistryData ? agentRegistryData.agents?.length : 0,
        uptime: Math.round(performance.now() / 1000) + 's'
    };
}
window.dashboardStatus = getDashboardStatus;


function updateLiveData() {
            // Randomly update pipeline value (simulation)
            const pipelineValue = document.getElementById('revenuePipeline');
            const currentValue = parseInt(pipelineValue.textContent.replace('$', '').replace('K', ''));
            const newValue = currentValue + (Math.random() > 0.9 ? 5 : 0);
            if (newValue !== currentValue && newValue <= 300) {
                pipelineValue.textContent = `$${newValue}K`;
                pipelineValue.style.color = 'var(--success)';
                setTimeout(() => {
                    pipelineValue.style.color = '';
                }, 1000);
                
                // Update progress bar
                const progress = Math.min(100, (newValue / 300) * 100);
                document.querySelector('.stat-card:nth-child(1) .stat-progress-bar').style.width = `${progress}%`;
            }
            
            // Update days remaining
            const targetDate = new Date('2026-06-30');
            const today = new Date();
            const daysRemaining = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
            document.getElementById('daysRemaining').textContent = daysRemaining;
        }


function updateTime() {
            const now = new Date();
            const subtitle = document.querySelector('.header .subtitle');
            if (subtitle) {
                subtitle.textContent = `All Documentation â€¢ Last updated: ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            }
        }


function addNewTask() {
            const title = prompt('Enter new task title:');
            if (title) {
                const owner = prompt('Task owner (jim/nick/ai/joint):');
                const due = prompt('Due date (e.g., Feb 7):');
                const priority = prompt('Priority (high/medium/low):');
                const description = prompt('Task description:');
                
                if (owner && tasks[owner]) {
                    const newId = Math.max(...Object.values(tasks).flat().map(t => t.id)) + 1;
                    tasks[owner].push({
                        id: newId,
                        title,
                        due: due || 'Feb 7',
                        priority: priority || 'medium',
                        completed: false,
                        description: description || title
                    });
                    
                    addNotification('success', `âœ… Added new task: "${title}"`);
                    updateStats();
                    renderAllTasks();
                }
            }
        }


function markAllComplete() {
            if (confirm('Mark all tasks as complete?')) {
                for (const taskList of Object.values(tasks)) {
                    taskList.forEach(task => task.completed = true);
                }
                addNotification('success', 'âœ… All tasks marked as complete');
                updateStats();
                renderAllTasks();
            }
        }


async function loadAgentRegistry() {
        try {
            const response = await fetch(AGENT_REGISTRY_URL + '?t=' + Date.now());
            if (!response.ok) throw new Error('Failed to load agent registry: ' + response.status);
            agentData = await response.json();
            if (agentData && agentData.agents) {
                console.log('âœ… Agent registry loaded:', agentData.agents.length, 'agents');
            }
            updateAgentDashboard();
            return agentData;
        } catch (error) {
            console.warn('âš ï¸ Using cached agent data:', error.message);
            // Fallback to embedded data
            try {
                agentData = getEmbeddedAgentData();
                updateAgentDashboard();
                return agentData;
            } catch (fallbackError) {
                console.error('âŒ Failed to load embedded agent data:', fallbackError);
                return null;
            }
        }
    }


function getEmbeddedAgentData() {
        return {
            agents: [
                { id: 'main', name: 'Main Agent', specialization: 'Coordination, project management, task delegation', current_status: 'active', availability: 'high', tasks_completed: 47, tasks_pending: 3, success_rate: 94, capabilities: ['coordination', 'documentation', 'system_design', 'troubleshooting'], contact_method: 'session:agent:main:main' },
                { id: 'content_creator', name: 'LinkedIn Execution Agent', specialization: 'LinkedIn content creation, social media strategy, scheduling', current_status: 'active', availability: 'high', tasks_completed: 23, tasks_pending: 2, success_rate: 91, capabilities: ['content_creation', 'social_media', 'copywriting', 'scheduling', 'linkedin_optimization'], contact_method: 'file:/home/jim/openclaw/CONTENT_CREATOR_AGENT.md' },
                { id: 'designer', name: 'Enhanced Branding & Design Agent', specialization: 'Branding, UI/UX design, visual assets, style guides', current_status: 'active', availability: 'medium', tasks_completed: 19, tasks_pending: 1, success_rate: 96, capabilities: ['graphic_design', 'ui_ux', 'branding', 'logo_design', 'style_guides'], contact_method: 'directory:/home/jim/openclaw/branding/' },
                { id: 'developer', name: 'CRM Development Agent', specialization: 'CRM development, dashboard improvements, web interfaces', current_status: 'active', availability: 'high', tasks_completed: 31, tasks_pending: 4, success_rate: 92, capabilities: ['web_development', 'dashboard_design', 'crm_integration', 'html_css_js', 'api_integration'], contact_method: 'directory:/home/jim/openclaw/crm/' },
                { id: 'ai_content', name: 'AI Content Generation Agent', specialization: 'Blogs, case studies, long-form content, research papers', current_status: 'available', availability: 'high', tasks_completed: 28, tasks_pending: 0, success_rate: 89, capabilities: ['blog_writing', 'case_studies', 'research', 'content_strategy'], contact_method: 'session:ai_content' },
                { id: 'analytics', name: 'Analytics & Reporting Agent', specialization: 'Data analysis, KPI tracking, performance reports', current_status: 'available', availability: 'medium', tasks_completed: 15, tasks_pending: 0, success_rate: 95, capabilities: ['data_analysis', 'reporting', 'kpi_tracking', 'visualization'], contact_method: 'session:analytics' },
                { id: 'market_research', name: 'Market Research Agent', specialization: 'Competitor analysis, market trends, opportunity identification', current_status: 'available', availability: 'medium', tasks_completed: 12, tasks_pending: 0, success_rate: 88, capabilities: ['market_research', 'competitor_analysis', 'trend_analysis', 'opportunity_identification'], contact_method: 'session:market_research' },
                { id: 'proposal_contract', name: 'Proposal & Contract Agent', specialization: 'Proposal drafting, contract templates, legal compliance', current_status: 'available', availability: 'medium', tasks_completed: 8, tasks_pending: 0, success_rate: 93, capabilities: ['proposal_writing', 'contract_templates', 'legal_documentation'], contact_method: 'session:proposal_contract' },
                { id: 'email_automation', name: 'Email Automation Agent', specialization: 'Email campaigns, automation workflows, drip sequences', current_status: 'active', availability: 'high', tasks_completed: 17, tasks_pending: 2, success_rate: 90, capabilities: ['email_campaigns', 'automation', 'workflows', 'drip_sequences'], contact_method: 'session:email_automation' },
                { id: 'coordination_system', name: 'Agent Coordination System', specialization: 'Task routing, load balancing, conflict resolution', current_status: 'active', availability: 'high', tasks_completed: 156, tasks_pending: 8, success_rate: 97, capabilities: ['coordination', 'routing', 'load_balancing', 'conflict_resolution'], contact_method: 'file:/home/jim/openclaw/shared_assets/tasks/agent_registry.json' },
                { id: 'communication_protocol', name: 'Agent Communication Protocol', specialization: 'Inter-agent messaging, status updates, notifications', current_status: 'active', availability: 'high', tasks_completed: 203, tasks_pending: 12, success_rate: 99, capabilities: ['communication', 'messaging', 'notifications', 'status_updates'], contact_method: 'session:communication' },
                { id: 'dashboard_enhancement', name: 'Dashboard Enhancement Agent', specialization: 'UI/UX improvements, feature additions, performance optimization', current_status: 'active', availability: 'medium', tasks_completed: 22, tasks_pending: 3, success_rate: 91, capabilities: ['ui_ux', 'feature_development', 'performance', 'optimization'], contact_method: 'session:dashboard_enhancement' },
                { id: 'graphic_design', name: 'Graphic Design Agent', specialization: 'Visual content, social media graphics, presentation designs', current_status: 'available', availability: 'high', tasks_completed: 34, tasks_pending: 0, success_rate: 94, capabilities: ['graphic_design', 'social_graphics', 'presentations', 'illustrations'], contact_method: 'directory:/home/jim/openclaw/branding/assets/' },
                { id: 'slack_troubleshooter', name: 'Slack Upload Troubleshooter', specialization: 'Slack integration debugging, file upload issues, bot management', current_status: 'available', availability: 'low', tasks_completed: 7, tasks_pending: 0, success_rate: 86, capabilities: ['slack_integration', 'troubleshooting', 'bot_management', 'api_debugging'], contact_method: 'session:slack_troubleshooter' },
                { id: 'coordination_dashboard', name: 'Agent Coordination Dashboard', specialization: 'Real-time monitoring, agent status visualization, performance tracking', current_status: 'active', availability: 'high', tasks_completed: 42, tasks_pending: 2, success_rate: 98, capabilities: ['monitoring', 'visualization', 'performance_tracking', 'reporting'], contact_method: 'file:/home/jim/openclaw/unified_dashboard.html' },
                { id: 'sdr_agent', name: 'Sales Development Representative (SDR) Agent', specialization: 'Outbound prospecting, LinkedIn outreach, lead qualification, BANT scoring', current_status: 'active', availability: 'high', tasks_completed: 0, tasks_pending: 1, success_rate: 0, capabilities: ['prospecting', 'linkedin_outreach', 'lead_qualification', 'bant_scoring', 'connection_requests', 'follow_up_sequences'], contact_method: 'file:/home/jim/openclaw/agents/training/SDR_AGENT_TRAINING.md' },
                { id: 'crm_sales_agent', name: 'CRM & Sales Pipeline Agent', specialization: 'Pipeline management, deal tracking, CRM automation, forecasting', current_status: 'active', availability: 'high', tasks_completed: 0, tasks_pending: 1, success_rate: 0, capabilities: ['pipeline_management', 'deal_tracking', 'crm_automation', 'forecasting', 'data_integrity', 'sales_reporting'], contact_method: 'file:/home/jim/openclaw/agents/training/CRM_SALES_AGENT_TRAINING.md' },
                { id: 'financial_agent', name: 'Financial Agent (CPA)', specialization: 'Financial planning, budgeting, forecasting, pricing strategy, revenue analysis, tax optimization', current_status: 'active', availability: 'high', tasks_completed: 0, tasks_pending: 1, success_rate: 0, capabilities: ['financial_planning', 'budgeting', 'forecasting', 'pricing_strategy', 'revenue_analysis', 'cash_flow', 'financial_reporting', 'tax_strategy', 'cpa_accounting', 'entity_optimization', 'rd_tax_credits'], contact_method: 'file:/home/jim/openclaw/agents/training/FINANCIAL_AGENT_TRAINING.md' },
                { id: 'paid_ads', name: 'Paid Advertising Agent', specialization: 'LinkedIn Ads, Google Ads, campaign management, budget optimization', current_status: 'available', availability: 'high', tasks_completed: 0, tasks_pending: 0, success_rate: 0, capabilities: ['linkedin_ads', 'google_ads', 'campaign_management', 'budget_optimization', 'a_b_testing', 'landing_page_optimization'], contact_method: 'file:/home/jim/openclaw/agents/training/PAID_ADS_AGENT_TRAINING.md' },
                { id: 'seo_content', name: 'SEO & Content Strategy Agent', specialization: 'SEO optimization, blog strategy, keyword research, content calendar', current_status: 'available', availability: 'high', tasks_completed: 0, tasks_pending: 0, success_rate: 0, capabilities: ['seo', 'content_strategy', 'keyword_research', 'blog_management', 'link_building', 'technical_seo'], contact_method: 'file:/home/jim/openclaw/agents/training/SEO_CONTENT_AGENT_TRAINING.md' },
                { id: 'customer_success', name: 'Customer Success Agent', specialization: 'Onboarding, retention, upsells, customer advocacy', current_status: 'available', availability: 'high', tasks_completed: 0, tasks_pending: 0, success_rate: 0, capabilities: ['onboarding', 'retention', 'upsells', 'customer_advocacy', 'health_monitoring', 'renewal_management'], contact_method: 'file:/home/jim/openclaw/agents/training/CUSTOMER_SUCCESS_AGENT_TRAINING.md' },
                { id: 'dashboard_ux', name: 'Dashboard UX & Information Architecture Agent', specialization: 'Dashboard design, information hierarchy, data visualization, user experience, Mission Control optimization', current_status: 'active', availability: 'busy', tasks_completed: 0, tasks_pending: 1, success_rate: 0, capabilities: ['dashboard_design', 'information_architecture', 'data_visualization', 'ux_design', 'mission_control', 'layout_optimization', 'metric_design', 'user_flow', 'html_css', 'javascript', 'chart_js'], contact_method: 'file:/home/jim/openclaw/agents/training/DASHBOARD_UX_AGENT_TRAINING.md' }
            ],
            coordination_metrics: {
                total_agents: 22,
                active_now: 11,
                available: 6,
                busy: 5,
                offline: 0,
                avg_success_rate: 92.3,
                tasks_completed_today: 23,
                tasks_pending: 28
            }
        };
    }


// AGENT REGISTRY DISPLAY FUNCTIONS
let currentAgentFilter = 'all';
let currentAgentSearch = '';
let selectedAgentId = null;

function renderAgentCardsGrid() {
    const container = document.getElementById('agentCardsGrid');
    if (!container || !agentData || !agentData.agents) return;

    let agents = agentData.agents;

    // Apply status filter
    if (currentAgentFilter !== 'all') {
        agents = agents.filter(agent => agent.current_status === currentAgentFilter);
    }

    // Apply search filter
    if (currentAgentSearch) {
        const searchLower = currentAgentSearch.toLowerCase();
        agents = agents.filter(agent => 
            agent.name.toLowerCase().includes(searchLower) ||
            agent.specialization.toLowerCase().includes(searchLower)
        );
    }

    if (agents.length === 0) {
        container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: var(--text-secondary);">
                <i class="fas fa-robot" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                <p>No agents found matching your criteria.</p>
            </div>
        `;
        return;
    }

    container.innerHTML = agents.map(agent => `
        <div class="agent-card-item status-${agent.current_status}" onclick="openAgentModal('${agent.id}')" data-agent-id="${agent.id}">
            <div class="agent-card-header">
                <div class="agent-card-info">
                    <h3>${agent.name}</h3>
                    <p>${agent.specialization}</p>
                </div>
                <span class="agent-status-badge ${agent.current_status}">${agent.current_status}</span>
            </div>
            <div class="agent-card-stats">
                <div class="agent-stat">
                    <div class="agent-stat-value" style="color: ${getSuccessRateColor(agent.success_rate)}">${agent.success_rate}%</div>
                    <div class="agent-stat-label">Success Rate</div>
                </div>
                <div class="agent-stat">
                    <div class="agent-stat-value">${agent.tasks_completed || 0}</div>
                    <div class="agent-stat-label">Completed</div>
                </div>
                <div class="agent-stat">
                    <div class="agent-stat-value" style="color: ${agent.tasks_pending > 0 ? '#f59e0b' : '#22c55e'}">${agent.tasks_pending || 0}</div>
                    <div class="agent-stat-label">Pending</div>
                </div>
            </div>
            <div class="agent-card-footer">
                <div class="agent-success-rate">
                    <i class="fas fa-chart-line"></i>
                    <span>Availability: <strong style="color: ${getAvailabilityColor(agent.availability)}">${agent.availability}</strong></span>
                </div>
                <button class="agent-view-details" onclick="event.stopPropagation(); openAgentModal('${agent.id}')">
                    View Details
                </button>
            </div>
        </div>
    `).join('');
}

function getSuccessRateColor(rate) {
    if (rate >= 90) return '#22c55e';
    if (rate >= 70) return '#f59e0b';
    return '#ef4444';
}

function getAvailabilityColor(availability) {
    const colors = { high: '#22c55e', medium: '#f59e0b', low: '#ef4444' };
    return colors[availability] || '#6b7280';
}

function filterByStatus(status) {
    currentAgentFilter = status;

    // Update button states
    document.querySelectorAll('.agent-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.filter === status) {
            btn.classList.add('active');
        }
    });

    renderAgentCardsGrid();
}

function filterAgentCards() {
    const searchInput = document.getElementById('agentSearchInput');
    currentAgentSearch = searchInput ? searchInput.value : '';
    renderAgentCardsGrid();
}

function updateAgentRegistrySummary() {
    if (!agentData || !agentData.agents) return;

    const agents = agentData.agents;
    const total = agents.length;
    const active = agents.filter(a => a.current_status === 'active').length;
    const available = agents.filter(a => a.current_status === 'available').length;
    const busy = agents.filter(a => a.current_status === 'busy').length;

    const totalEl = document.getElementById('summaryTotalAgents');
    const activeEl = document.getElementById('summaryActiveAgents');
    const availableEl = document.getElementById('summaryAvailableAgents');
    const busyEl = document.getElementById('summaryBusyAgents');

    if (totalEl) totalEl.textContent = total;
    if (activeEl) activeEl.textContent = active;
    if (availableEl) availableEl.textContent = available;
    if (busyEl) busyEl.textContent = busy;
}

function openAgentModal(agentId) {
    const agent = agentData?.agents?.find(a => a.id === agentId);
    if (!agent) return;

    selectedAgentId = agentId;

    const modal = document.getElementById('agentDetailsModal');
    const nameEl = document.getElementById('modalAgentName');
    const bodyEl = document.getElementById('modalAgentBody');

    if (nameEl) nameEl.textContent = agent.name;

    if (bodyEl) {
        const capabilities = agent.capabilities ? agent.capabilities.map(cap => 
            `<span class="agent-capability-tag">${cap.replace(/_/g, ' ')}</span>`
        ).join('') : '<span class="agent-capability-tag">General Purpose</span>';

        bodyEl.innerHTML = `
            <div class="agent-detail-row">
                <span class="agent-detail-label">Specialization</span>
                <span class="agent-detail-value">${agent.specialization}</span>
            </div>
            <div class="agent-detail-row">
                <span class="agent-detail-label">Status</span>
                <span class="agent-detail-value" style="color: ${getStatusColor(agent.current_status)}">${agent.current_status.toUpperCase()}</span>
            </div>
            <div class="agent-detail-row">
                <span class="agent-detail-label">Availability</span>
                <span class="agent-detail-value" style="color: ${getAvailabilityColor(agent.availability)}">${agent.availability.toUpperCase()}</span>
            </div>
            <div class="agent-detail-row">
                <span class="agent-detail-label">Success Rate</span>
                <span class="agent-detail-value" style="color: ${getSuccessRateColor(agent.success_rate)}">${agent.success_rate}%</span>
            </div>
            <div class="agent-detail-row">
                <span class="agent-detail-label">Tasks Completed</span>
                <span class="agent-detail-value">${agent.tasks_completed || 0}</span>
            </div>
            <div class="agent-detail-row">
                <span class="agent-detail-label">Tasks Pending</span>
                <span class="agent-detail-value" style="color: ${agent.tasks_pending > 0 ? '#f59e0b' : '#22c55e'}">${agent.tasks_pending || 0}</span>
            </div>
            <div class="agent-detail-row">
                <span class="agent-detail-label">Contact Method</span>
                <span class="agent-detail-value">${agent.contact_method || 'Session-based'}</span>
            </div>
            <div class="agent-detail-row" style="flex-direction: column; align-items: flex-start;">
                <span class="agent-detail-label" style="margin-bottom: 10px;">Capabilities</span>
                <div class="agent-capabilities-list">
                    ${capabilities}
                </div>
            </div>
        `;
    }

    if (modal) modal.classList.add('active');
}

function getStatusColor(status) {
    const colors = { active: '#22c55e', available: '#f59e0b', busy: '#ef4444', offline: '#6b7280' };
    return colors[status] || '#6b7280';
}

function closeAgentModal() {
    const modal = document.getElementById('agentDetailsModal');
    if (modal) modal.classList.remove('active');
    selectedAgentId = null;
}

function assignTaskToModalAgent() {
    if (selectedAgentId) {
        assignTaskToAgent(selectedAgentId);
    }
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('agentDetailsModal');
    if (event.target === modal) {
        closeAgentModal();
    }
}

function updateAgentDashboard() {
        if (!agentData) return;
        
        const metrics = agentData.coordination_metrics || getEmbeddedAgentData().coordination_metrics;
        
        // Update stat cards
        updateStatValue('totalAgents', metrics.total_agents);
        updateStatValue('activeAgents', metrics.active_now);
        updateStatValue('completedAgents', metrics.total_agents - metrics.busy);
        updateStatValue('completionRate', Math.round(metrics.avg_success_rate) + '%');
        
        // Update progress bars
        const completionBar = document.getElementById('overallCompletionBar');
        if (completionBar) {
            completionBar.style.width = metrics.avg_success_rate + '%';
        }
        
        // Update agent cards
        updateAgentCards();
        
        console.log('ðŸ“Š Agent dashboard updated');
    }


function updateStatValue(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
            element.style.opacity = '0';
            setTimeout(() => {
                element.textContent = value;
                element.style.opacity = '1';
            }, 200);
        }
    }


function updateAgentCards() {
        if (!agentData || !agentData.agents) return;
        
        // Update the agents card in integrations grid
        const activeCount = agentData.agents.filter(a => a.current_status === 'active').length;
        const availableCount = agentData.agents.filter(a => a.current_status === 'available').length;
        
        const activeCountEl = document.getElementById('activeAgentCount');
        const totalCountEl = document.getElementById('totalAgentCount');
        
        if (activeCountEl) activeCountEl.textContent = activeCount;
        if (totalCountEl) totalCountEl.textContent = availableCount;
        
        // Render agent cards into registry container
        renderAgentRegistryCards();
    }


function renderAgentRegistryCards() {
        const container = document.getElementById('agentRegistry');
        if (!container || !agentData || !agentData.agents) return;
        
        const statusColors = {
            active: '#22c55e',
            available: '#3b82f6',
            busy: '#f59e0b',
            offline: '#6b7280'
        };
        
        const availabilityColors = {
            high: '#22c55e',
            medium: '#f59e0b',
            low: '#ef4444'
        };
        
        container.innerHTML = agentData.agents.map(agent => `
            <div class="agent-card" data-agent-id="${agent.id}" style="
                background: var(--dark-card);
                border: 1px solid var(--dark-border);
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 15px;
                transition: all 0.2s ease;
                cursor: pointer;
            " onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='var(--dark-border)'">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                    <div>
                        <div style="font-weight: 600; font-size: 1.1rem; color: var(--text-primary); margin-bottom: 4px;">
                            ${agent.name}
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            ${agent.specialization}
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <span style="
                            background: ${statusColors[agent.current_status] || '#6b7280'}20;
                            color: ${statusColors[agent.current_status] || '#6b7280'};
                            padding: 4px 12px;
                            border-radius: 20px;
                            font-size: 0.8rem;
                            font-weight: 500;
                            text-transform: uppercase;
                        ">${agent.current_status}</span>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--dark-border);">
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px;">Availability</div>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: ${availabilityColors[agent.availability] || '#6b7280'};"></div>
                            <span style="font-weight: 500; color: var(--text-primary); text-transform: capitalize;">${agent.availability}</span>
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px;">Tasks Pending</div>
                        <div style="font-weight: 600; color: var(--text-primary);">${agent.tasks_pending || 0}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px;">Success Rate</div>
                        <div style="font-weight: 600; color: ${agent.success_rate >= 90 ? '#22c55e' : agent.success_rate >= 70 ? '#f59e0b' : '#ef4444'};">
                            ${agent.success_rate}%
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                        <i class="fas fa-check-circle" style="color: var(--success); margin-right: 5px;"></i>
                        ${agent.tasks_completed || 0} tasks completed
                    </div>
                    <button onclick="viewAgentDetails('${agent.id}')" style="
                        background: transparent;
                        border: 1px solid var(--primary);
                        color: var(--primary);
                        padding: 6px 14px;
                        border-radius: 6px;
                        font-size: 0.85rem;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    " onmouseover="this.style.background='var(--primary)'; this.style.color='white'" onmouseout="this.style.background='transparent'; this.style.color='var(--primary)'">
                        View Details
                    </button>
                </div>
            </div>
        `).join('');
    }


function viewAgentDetails(agentId) {
        const agent = agentData?.agents?.find(a => a.id === agentId);
        if (!agent) return;
        
        // Create modal content
        const modalContent = `
            <div style="max-width: 600px;">
                <h2 style="margin-bottom: 20px; color: var(--text-primary);">${agent.name}</h2>
                <div style="margin-bottom: 20px;">
                    <strong>Specialization:</strong> ${agent.specialization}
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Status:</strong> <span style="text-transform: capitalize;">${agent.current_status}</span>
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Availability:</strong> <span style="text-transform: capitalize;">${agent.availability}</span>
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Tasks Completed:</strong> ${agent.tasks_completed || 0}
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Tasks Pending:</strong> ${agent.tasks_pending || 0}
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Success Rate:</strong> ${agent.success_rate}%
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Contact Method:</strong> ${agent.contact_method || 'Session-based'}
                </div>
                <div style="margin-top: 30px; display: flex; gap: 10px;">
                    <button onclick="assignTaskToAgent('${agent.id}')" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Assign Task
                    </button>
                    <button onclick="closeModal()" class="btn btn-secondary">
                        Close
                    </button>
                </div>
            </div>
        `;
        
        showModal(modalContent);
    }


function assignTaskToAgent(agentId) {
        const title = prompt('Enter task title:');
        if (!title) return;
        
        const description = prompt('Enter task description:');
        const priority = prompt('Priority (critical/high/medium/low):', 'medium');
        
        const task = {
            title: title,
            description: description || '',
            priority: priority || 'medium'
        };
        
        const result = assignTask(agentId, task);
        if (result) {
            closeModal();
            renderAgentRegistryCards();
        }
    }


function assignTask(agentId, task) {
        const agent = agentData?.agents?.find(a => a.id === agentId);
        if (!agent) {
            console.error('âŒ Agent not found:', agentId);
            return false;
        }
        
        if (agent.current_status === 'offline' || agent.availability === 'low') {
            console.warn('âš ï¸ Agent unavailable:', agent.name);
            return false;
        }
        
        const taskAssignment = {
            task_id: 'TASK-' + Date.now(),
            agent_id: agentId,
            agent_name: agent.name,
            title: task.title,
            description: task.description,
            priority: task.priority || 'medium',
            status: 'assigned',
            assigned_at: new Date().toISOString(),
            due: task.due || new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
            progress: 0
        };
        
        taskQueue.push(taskAssignment);
        agent.tasks_pending++;
        
        console.log('âœ… Task assigned to', agent.name, ':', task.title);
        addNotification('success', `ðŸ“‹ Task assigned to ${agent.name}`);
        
        return taskAssignment;
    }


function findBestAgent(taskType, requirements = []) {
        if (!agentData || !agentData.agents) return null;
        
        const availableAgents = agentData.agents.filter(a => 
            (a.current_status === 'available' || a.current_status === 'active') &&
            a.availability !== 'low'
        );
        
        if (availableAgents.length === 0) {
            console.warn('âš ï¸ No available agents');
            return null;
        }
        
        // Score agents based on capability match and current load
        const scoredAgents = availableAgents.map(agent => {
            let score = 0;
            
            // Capability match
            if (agent.capabilities && agent.capabilities.includes(taskType)) {
                score += 50;
            }
            
            // Success rate
            score += (agent.success_rate || 90) * 0.3;
            
            // Availability (prefer less busy agents)
            const availabilityScore = {
                'high': 20,
                'medium': 10,
                'low': 0
            }[agent.availability] || 0;
            score += availabilityScore;
            
            // Penalize high pending task count
            score -= (agent.tasks_pending || 0) * 5;
            
            return { agent, score };
        });
        
        // Sort by score descending
        scoredAgents.sort((a, b) => b.score - a.score);
        
        console.log('ðŸŽ¯ Best agent for', taskType, ':', scoredAgents[0]?.agent?.name);
        return scoredAgents[0]?.agent || availableAgents[0];
    }


function autoAssignTask(task) {
        const bestAgent = findBestAgent(task.task_type, task.requirements);
        if (bestAgent) {
            return assignTask(bestAgent.id, task);
        }
        console.error('âŒ Could not auto-assign task:', task.title);
        return null;
    }


function sendAgentMessage(fromAgentId, toAgentId, message, priority = 'normal') {
        const msg = {
            id: 'MSG-' + Date.now(),
            from: fromAgentId,
            to: toAgentId,
            content: message,
            priority: priority,
            timestamp: new Date().toISOString(),
            read: false
        };
        
        agentMessages.push(msg);
        
        if (priority === 'high') {
            addNotification('alert', `ðŸ“¨ High priority message from ${fromAgentId}`);
        }
        
        console.log('ðŸ“¨ Message sent:', fromAgentId, 'â†’', toAgentId);
        return msg;
    }


function broadcastToAgents(fromAgentId, message, excludeOffline = true) {
        if (!agentData || !agentData.agents) return;
        
        agentData.agents.forEach(agent => {
            if (agent.id !== fromAgentId) {
                if (!excludeOffline || agent.current_status !== 'offline') {
                    sendAgentMessage(fromAgentId, agent.id, message);
                }
            }
        });
        
        console.log('ðŸ“¢ Broadcast sent from', fromAgentId, 'to all agents');
    }


function updateAgentMetrics(agentId, metricUpdate) {
        const agent = agentData?.agents?.find(a => a.id === agentId);
        if (!agent) return;
        
        if (metricUpdate.tasks_completed !== undefined) {
            agent.tasks_completed = metricUpdate.tasks_completed;
        }
        if (metricUpdate.tasks_pending !== undefined) {
            agent.tasks_pending = metricUpdate.tasks_pending;
        }
        if (metricUpdate.success_rate !== undefined) {
            agent.success_rate = metricUpdate.success_rate;
        }
        if (metricUpdate.current_status !== undefined) {
            agent.current_status = metricUpdate.current_status;
        }
        
        // Update last active timestamp
        agent.last_active = new Date().toISOString();
        
        console.log('ðŸ“ˆ Metrics updated for', agent.name);
        updateAgentDashboard();
    }


function generateCoordinationReport() {
        if (!agentData) return null;
        
        const report = {
            timestamp: new Date().toISOString(),
            summary: {
                total_agents: agentData.agents.length,
                active_agents: agentData.agents.filter(a => a.current_status === 'active').length,
                available_agents: agentData.agents.filter(a => a.current_status === 'available').length,
                busy_agents: agentData.agents.filter(a => a.current_status === 'busy').length,
                offline_agents: agentData.agents.filter(a => a.current_status === 'offline').length,
                avg_success_rate: Math.round(agentData.agents.reduce((sum, a) => sum + (a.success_rate || 0), 0) / agentData.agents.length),
                total_tasks_completed: agentData.agents.reduce((sum, a) => sum + (a.tasks_completed || 0), 0),
                total_tasks_pending: agentData.agents.reduce((sum, a) => sum + (a.tasks_pending || 0), 0)
            },
            agents: agentData.agents.map(a => ({
                id: a.id,
                name: a.name,
                status: a.current_status,
                availability: a.availability,
                tasks_completed: a.tasks_completed,
                tasks_pending: a.tasks_pending,
                success_rate: a.success_rate
            })),
            task_queue: taskQueue,
            recent_messages: agentMessages.slice(-10)
        };
        
        console.log('ðŸ“Š Coordination report generated');
        return report;
    }


function exportAgentReport() {
        const report = generateCoordinationReport();
        if (!report) {
            addNotification('error', 'âŒ Failed to generate report');
            return;
        }
        
        const dataStr = JSON.stringify(report, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = `agent-coordination-report-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        
        addNotification('success', 'ðŸ“Š Agent report exported');
    }


function refreshAgentData() {
        addNotification('info', 'ðŸ”„ Refreshing agent data...');
        loadAgentRegistry().then(() => {
            addNotification('success', 'âœ… Agent data refreshed');
        }).catch(error => {
            addNotification('error', 'âŒ Failed to refresh agent data');
        });
    }


function renderAgentTasks(filter = 'all') {
        const container = document.getElementById('agentTaskGrid');
        if (!container) return;
        
        // Sample tasks for demonstration
        const tasks = [
            { id: 1, title: 'Create LinkedIn post for Feb 4', agent: 'LinkedIn Execution Agent', priority: 'high', progress: 60, status: 'in_progress' },
            { id: 2, title: 'Fix dashboard color scheme', agent: 'Dashboard Enhancement Agent', priority: 'medium', progress: 90, status: 'in_progress' },
            { id: 3, title: 'Update agent coordination system', agent: 'Agent Coordination System', priority: 'critical', progress: 35, status: 'in_progress' },
            { id: 4, title: 'Design new landing page', agent: 'Branding & Design Agent', priority: 'medium', progress: 20, status: 'pending' },
            { id: 5, title: 'Write blog post about VR in education', agent: 'AI Content Generation Agent', priority: 'low', progress: 0, status: 'pending' },
            { id: 6, title: 'Analyze Q1 performance metrics', agent: 'Analytics & Reporting Agent', priority: 'high', progress: 45, status: 'in_progress' }
        ];
        
        const filteredTasks = filter === 'all' ? tasks : tasks.filter(t => t.priority === filter);
        
        container.innerHTML = filteredTasks.map(task => `
            <div class="agent-task-card ${task.priority}">
                <div class="agent-task-header">
                    <div class="agent-task-title">${task.title}</div>
                    <div class="agent-task-priority ${task.priority}">${task.priority}</div>
                </div>
                <div class="agent-task-meta">
                    <span><i class="fas fa-robot"></i> ${task.agent}</span>
                    <span><i class="fas fa-clock"></i> ${task.status}</span>
                </div>
                <div class="agent-task-progress">
                    <div class="progress-label">Progress: ${task.progress}%</div>
                    <div class="progress-bar-small">
                        <div class="progress-fill-small" style="width: ${task.progress}%; background-color: var(--${task.priority === 'critical' ? 'danger' : task.priority === 'high' ? 'success' : 'primary'});"></div>
                    </div>
                </div>
            </div>
        `).join('');
    }


function filterTasksByPriority(priority) {
        document.querySelectorAll('.agent-task-filter').forEach(f => f.classList.remove('active'));
        event.target.classList.add('active');
        renderAgentTasks(priority);
    }


function renderPriorityQueue() {
        const priorities = ['critical', 'high', 'medium', 'low'];
        const sampleTasks = {
            critical: [
                { id: 1, title: 'Fix production bug', agent: 'Developer Agent' }
            ],
            high: [
                { id: 2, title: 'Create LinkedIn post', agent: 'LinkedIn Agent' },
                { id: 3, title: 'Update dashboard', agent: 'Dashboard Agent' }
            ],
            medium: [
                { id: 4, title: 'Design landing page', agent: 'Design Agent' }
            ],
            low: [
                { id: 5, title: 'Research competitors', agent: 'Research Agent' }
            ]
        };
        
        priorities.forEach(priority => {
            const container = document.getElementById(`${priority}Tasks`);
            const countEl = document.getElementById(`${priority}Count`);
            if (container) {
                const tasks = sampleTasks[priority] || [];
                countEl.textContent = tasks.length;
                container.innerHTML = tasks.map(task => `
                    <div class="priority-task-item" draggable="true">
                        <div style="font-weight: 600; margin-bottom: 5px;">${task.title}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                            <i class="fas fa-robot"></i> ${task.agent}
                        </div>
                    </div>
                `).join('');
            }
        });
    }


function refreshPriorityQueue() {
        renderPriorityQueue();
        addNotification('success', 'ðŸ”„ Priority queue refreshed');
    }


function addPriorityTask() {
        const title = prompt('Enter task title:');
        if (!title) return;
        
        const priority = prompt('Priority (critical/high/medium/low):', 'medium');
        const agent = prompt('Assign to agent:', 'Main Agent');
        
        addNotification('success', `âœ… Task "${title}" added with ${priority} priority`);
        renderPriorityQueue();
    }


function renderWorkloadChart() {
        const container = document.getElementById('workloadChartContainer');
        if (!container) return;
        
        if (!agentData || !agentData.agents) return;
        
        const workloadData = agentData.agents.map(agent => {
            const workload = Math.min(100, (agent.tasks_pending || 0) * 20 + (agent.tasks_completed || 0) * 0.5);
            let level = 'low';
            if (workload > 80) level = 'critical';
            else if (workload > 60) level = 'high';
            else if (workload > 40) level = 'medium';
            
            return {
                name: agent.name,
                workload: Math.round(workload),
                level: level,
                tasks: agent.tasks_pending || 0
            };
        });
        
        container.innerHTML = workloadData.map(agent => `
            <div class="agent-workload-item">
                <div class="agent-workload-name">${agent.name}</div>
                <div class="agent-workload-bar">
                    <div class="agent-workload-fill ${agent.level}" style="width: ${agent.workload}%"></div>
                </div>
                <div class="agent-workload-value">${agent.workload}%</div>
            </div>
        `).join('');
    }


function analyzeWorkload() {
        renderWorkloadChart();
        addNotification('info', 'ðŸ” Workload analysis complete');
    }


function rebalanceWorkload() {
        addNotification('info', 'âš–ï¸ Rebalancing workload...');
        setTimeout(() => {
            addNotification('success', 'âœ… Workload rebalanced');
            renderWorkloadChart();
        }, 1500);
    }


function redistributeTasks() {
        addNotification('info', 'ðŸ”„ Redistributing tasks...');
        setTimeout(() => {
            addNotification('success', 'âœ… Tasks redistributed');
        }, 1500);
    }


function identifyBottlenecks() {
        const busyAgents = agentData?.agents?.filter(a => (a.tasks_pending || 0) > 3) || [];
        if (busyAgents.length > 0) {
            addNotification('warning', `âš ï¸ Found ${busyAgents.length} agents with high workload`);
        } else {
            addNotification('success', 'âœ… No bottlenecks detected');
        }
    }


function suggestReassignments() {
        addNotification('info', 'ðŸ’¡ Analyzing optimal task distribution...');
        setTimeout(() => {
            addNotification('success', 'âœ… Suggestions ready (see console)');
            console.log('Task reassignment suggestions:', [
                { task: 'LinkedIn Post', from: 'LinkedIn Agent', to: 'AI Content Agent', reason: 'Better availability' },
                { task: 'Dashboard Fix', from: 'Dashboard Agent', to: 'Developer Agent', reason: 'Technical expertise' }
            ]);
        }, 1500);
    }


function viewCapacityPlanning() {
        addNotification('info', 'ðŸ“Š Capacity planning report generated');
        console.log('Capacity Planning:', {
            totalCapacity: '140 hours/week',
            utilizedCapacity: '98 hours/week (70%)',
            availableCapacity: '42 hours/week',
            recommendations: ['Hire additional designer', 'Optimize meeting schedules']
        });
    }


function sendAgentChatMessage() {
        const input = document.getElementById('agentChatInput');
        const messagesContainer = document.getElementById('agentChatMessages');
        const agentSelector = document.getElementById('chatAgentSelector');
        
        if (!input || !messagesContainer || !input.value.trim()) return;
        
        const message = input.value.trim();
        const target = agentSelector ? agentSelector.value : 'broadcast';
        
        // Add outgoing message
        const msgDiv = document.createElement('div');
        msgDiv.className = 'agent-chat-message outgoing';
        msgDiv.innerHTML = `
            <div class="agent-chat-message-header">
                <span>You</span>
                <span>${new Date().toLocaleTimeString()}</span>
            </div>
            <div>${message}</div>
        `;
        messagesContainer.appendChild(msgDiv);
        
        input.value = '';
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        // Simulate response
        if (target !== 'broadcast') {
            setTimeout(() => {
                const responseDiv = document.createElement('div');
                responseDiv.className = 'agent-chat-message incoming';
                responseDiv.innerHTML = `
                    <div class="agent-chat-message-header">
                        <span>${target.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</span>
                        <span>${new Date().toLocaleTimeString()}</span>
                    </div>
                    <div>Received! Working on it...</div>
                `;
                messagesContainer.appendChild(responseDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 1000);
        }
    }


function handleChatKeypress(event) {
        if (event.key === 'Enter') {
            sendAgentChatMessage();
        }
    }


function clearChatHistory() {
        const messagesContainer = document.getElementById('agentChatMessages');
        if (messagesContainer) {
            messagesContainer.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 20px;">Chat history cleared</div>';
        }
    }


function autoAssignAllTasks() {
        addNotification('info', 'ðŸ¤– Auto-assigning all pending tasks...');
        setTimeout(() => {
            addNotification('success', 'âœ… 6 tasks auto-assigned to optimal agents');
            renderAgentTasks();
        }, 1500);
    }


function filterAgentTasks() {
        const selector = document.getElementById('agentTaskFilter');
        if (selector) {
            renderAgentTasks(selector.value);
        }
    }


function initPerformanceCharts() {
        // Initialize Revenue Trajectory Chart
        initRevenueTrajectoryChart();
        
        // Completion Rate Chart
        const completionCtx = document.getElementById('completionRateChart');
        if (completionCtx) {
            new Chart(completionCtx, {
                type: 'bar',
                data: {
                    labels: ['LinkedIn', 'Design', 'Dev', 'Content', 'Analytics'],
                    datasets: [{
                        label: 'Tasks Completed',
                        data: [23, 19, 31, 28, 15],
                        backgroundColor: '#ff6b00'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        // Response Time Chart
        const responseCtx = document.getElementById('responseTimeChart');
        if (responseCtx) {
            new Chart(responseCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                    datasets: [{
                        label: 'Avg Response Time (min)',
                        data: [15, 12, 18, 10, 14],
                        borderColor: '#132e5e',
                        backgroundColor: 'rgba(19, 46, 94, 0.1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Success Rate Trend Chart
        const successCtx = document.getElementById('successRateTrendChart');
        if (successCtx) {
            new Chart(successCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Success Rate %',
                        data: [88, 90, 91, 92.3],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { min: 80, max: 100 }
                    }
                }
            });
        }
        
        // Workload Distribution Chart
        const workloadCtx = document.getElementById('workloadDistributionChart');
        if (workloadCtx) {
            new Chart(workloadCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Active', 'Available', 'Busy', 'Offline'],
                    datasets: [{
                        data: [8, 3, 5, 1],
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // NEW ANALYTICS CHARTS
        // Revenue Trend Chart
        const revenueCtx = document.getElementById('revenueTrendChart');
        if (revenueCtx) {
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Pipeline ($K)',
                        data: [15, 45, 85, 140, 210, 300],
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Closed ($K)',
                        data: [5, 12, 28, 55, 95, 150],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
        
        // Agent Performance Chart
        const agentPerfCtx = document.getElementById('agentPerformanceChart');
        if (agentPerfCtx) {
            new Chart(agentPerfCtx, {
                type: 'radar',
                data: {
                    labels: ['Speed', 'Quality', 'Communication', 'Tasks', 'Success', 'Availability'],
                    datasets: [{
                        label: 'SDR Agent',
                        data: [85, 92, 88, 75, 90, 95],
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.2)'
                    }, {
                        label: 'CRM Agent',
                        data: [90, 88, 85, 90, 92, 88],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.2)'
                    }, {
                        label: 'Financial Agent',
                        data: [88, 95, 90, 85, 94, 92],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: { min: 0, max: 100 }
                    }
                }
            });
        }
        
        // Task Distribution Doughnut
        const taskDistCtx = document.getElementById('taskDistributionChart');
        if (taskDistCtx) {
            new Chart(taskDistCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Sales', 'Marketing', 'Development', 'Finance', 'Operations'],
                    datasets: [{
                        data: [35, 25, 20, 12, 8],
                        backgroundColor: [
                            '#22c55e',
                            '#3b82f6',
                            '#f59e0b',
                            '#60a5fa',
                            '#ec4899'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    },
                    cutout: '65%'
                }
            });
        }
        
        // Weekly Activity Chart
        const weeklyCtx = document.getElementById('weeklyActivityChart');
        if (weeklyCtx) {
            new Chart(weeklyCtx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Tasks Completed',
                        data: [12, 19, 15, 22, 18, 8, 5],
                        backgroundColor: '#3b82f6',
                        borderRadius: 6
                    }, {
                        label: 'New Leads',
                        data: [5, 8, 6, 10, 7, 3, 2],
                        backgroundColor: '#22c55e',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    },
                    scales: {
                        y: { beginAtZero: true },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // Pipeline Doughnut Chart
        const pipelineDoughnutCtx = document.getElementById('pipelineDoughnutChart');
        if (pipelineDoughnutCtx) {
            new Chart(pipelineDoughnutCtx, {
                type: 'doughnut',
                data: {
                    labels: ['District Licensing', 'Custom Experiences', 'AI Lesson Generation', 'Professional Development'],
                    datasets: [{
                        data: [150000, 75000, 50000, 10000],
                        backgroundColor: ['#3b82f6', '#ff6b00', '#0d9488', '#f59e0b'],
                        borderColor: '#1e293b',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#94a3b8', padding: 15 } },
                        tooltip: {
                            callbacks: {
                                label: function(ctx) {
                                    return ctx.label + ': $' + ctx.parsed.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Team Completion Bar Chart
        const teamCompletionCtx = document.getElementById('teamCompletionChart');
        if (teamCompletionCtx) {
            new Chart(teamCompletionCtx, {
                type: 'bar',
                data: {
                    labels: ['Jim', 'Nick', 'AI Assistant', 'Joint'],
                    datasets: [
                        {
                            label: 'Assigned',
                            data: [3, 4, 5, 3],
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: '#3b82f6',
                            borderWidth: 1
                        },
                        {
                            label: 'Completed',
                            data: [1, 1, 2, 0],
                            backgroundColor: 'rgba(16, 185, 129, 0.6)',
                            borderColor: '#10b981',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(51,65,85,0.3)' } },
                        y: { beginAtZero: true, ticks: { color: '#94a3b8', stepSize: 1 }, grid: { color: 'rgba(51,65,85,0.3)' } }
                    },
                    plugins: {
                        legend: { labels: { color: '#94a3b8' } }
                    }
                }
            });
        }
    }


function refreshAnalytics() {
        addNotification('info', 'ðŸ“Š Refreshing analytics data...');
        setTimeout(() => {
            initPerformanceCharts();
            addNotification('success', 'âœ… Analytics updated');
        }, 1000);
    }


function exportAnalytics() {
        const data = {
            timestamp: new Date().toISOString(),
            revenue: { pipeline: 45000, closed: 12000, target: 300000 },
            tasks: { completed: 847, pending: 28, total: 875 },
            agents: { active: 11, available: 6, total: 20 },
            performance: { successRate: 94, avgResponseTime: 2.4 }
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `analytics-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        addNotification('success', 'ðŸ“Š Analytics exported');
    }


function updatePerformanceCharts() {
        // Re-initialize with new time range data
        initPerformanceCharts();
    }


function exportChartData() {
        addNotification('success', 'ðŸ“Š Chart data exported to console');
        console.log('Performance Chart Data:', {
            completionRates: { linkedin: 23, design: 19, dev: 31, content: 28, analytics: 15 },
            responseTimes: [15, 12, 18, 10, 14],
            successRates: [88, 90, 91, 92.3],
            workloadDistribution: { active: 8, available: 3, busy: 5, offline: 1 }
        });
    }




// Logout function
function logout() {
    localStorage.removeItem('ascent_session');
    window.location.href = 'login.html';
}

// INITIALIZATION
document.addEventListener('DOMContentLoaded', function() {
    console.log('ðŸš€ Initializing Ascent XR Dashboard v19...');
    
    // Add visible version indicator to page
    const versionIndicator = document.createElement('div');
    versionIndicator.id = 'versionIndicator';
    versionIndicator.style.cssText = 'position:fixed;bottom:10px;right:10px;background:rgba(0,0,0,0.7);color:#fff;padding:5px 10px;border-radius:4px;font-size:12px;z-index:9999;font-family:monospace;';
    versionIndicator.textContent = 'v19.0 | Feb 3, 2026';
    document.body.appendChild(versionIndicator);
    
    renderAllTasks();
    setupNavigation();
    updateStats();
    
    // Display current user info on load
    if (window.currentUser) {
        const userNameEl = document.getElementById('userName');
        const userRoleEl = document.getElementById('userRole');
        if (userNameEl) userNameEl.textContent = window.currentUser.name || 'Admin';
        if (userRoleEl) userRoleEl.textContent = window.currentUser.role || 'Admin';
    }

    // Update header user menu from session data
    const session = JSON.parse(localStorage.getItem('ascent_session') || '{}');
    if (session.name) {
        const userMenu = document.getElementById('headerUserMenu');
        if (userMenu) {
            const initial = session.name.charAt(0).toUpperCase();
            const gradient = session.role === 'CTO' ? 'linear-gradient(135deg, #3b82f6, #1d4ed8)' : 'linear-gradient(135deg, #ff6b00, #d97706)';
            userMenu.querySelector('div > div:first-child').style.background = gradient;
            userMenu.querySelector('div > div:first-child').textContent = initial;
            userMenu.querySelector('div > div:nth-child(2) > div:first-child').textContent = session.name;
            userMenu.querySelector('div > div:nth-child(2) > div:last-child').textContent = session.role || '';
        }
    }

    // Load initial view
    switchView('overview');
    // Auto-updates enabled
    setInterval(updateLiveData, 10000);
    setInterval(updateTime, 60000);
    // setInterval(refreshIntegrations, 1000);
    // Load agent registry
    loadAgentRegistry().then(() => {
        // Render UI components
        renderAgentTasks();
        renderPriorityQueue();
        renderWorkloadChart();
        initPerformanceCharts();
        // Render agent registry section
        renderAgentCardsGrid();
        updateAgentRegistrySummary();
    });
    // Periodic refresh disabled - update on page load only
    // setInterval(() => {
    // updateAgentDashboard();
    // renderWorkloadChart();
    // }, 30000);
    // Render live updates
    if (typeof renderLiveUpdates === 'function') {
        renderLiveUpdates();
    }
    
    // Session timeout check (every minute)
    setInterval(function() {
        const session = localStorage.getItem('ascent_session');
        if (!session) {
            window.location.href = 'login.html';
            return;
        }
        try {
            const sessionData = JSON.parse(session);
            if (sessionData.expires < Date.now()) {
                logout();
            }
        } catch (e) {
            logout();
        }
    }, 60000);
    
    // LinkedIn countdown timer
    setInterval(function() {
        const countdownElement = document.getElementById('linkedinCountdown');
        if (countdownElement) {
            const text = countdownElement.textContent;
            const match = text.match(/(\d+)h\s*(\d+)m/);
            if (match) {
                let hours = parseInt(match[1]);
                let minutes = parseInt(match[2]);
                minutes--;
                if (minutes < 0) {
                    minutes = 59;
                    hours--;
                }
                if (hours >= 0) {
                    countdownElement.textContent = hours + 'h ' + minutes + 'm';
                }
            }
        }
    }, 60000);
    
    console.log('âœ… Dashboard v19 initialized successfully');
});
    </script>

    <!-- API Integration, Auto-Refresh, Keyboard Shortcuts, Role-Based Views -->
    <script>
    (function() {
        'use strict';

        // ===== AUTH HELPER =====
        function getAuthToken() {
            return localStorage.getItem('ascent_token');
        }

        function authHeaders() {
            const token = getAuthToken();
            return token ? { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' } : {};
        }

        async function apiFetch(url) {
            try {
                const res = await fetch(url, { headers: authHeaders() });
                if (res.status === 401) {
                    window.location.href = 'login.html';
                    return null;
                }
                if (!res.ok) return null;
                const data = await res.json();
                return data.success ? data.data : null;
            } catch (err) {
                console.warn('API fetch failed for', url, err.message);
                return null;
            }
        }

        // ===== LOADING SKELETON =====
        function showSkeleton(el) {
            if (!el) return;
            el.style.position = 'relative';
            const skeleton = document.createElement('div');
            skeleton.className = 'api-skeleton';
            skeleton.style.cssText = 'position:absolute;inset:0;background:linear-gradient(90deg,rgba(30,41,59,0.5) 25%,rgba(51,65,85,0.5) 50%,rgba(30,41,59,0.5) 75%);background-size:200% 100%;animation:skeleton-pulse 1.5s ease infinite;border-radius:inherit;z-index:5;';
            el.appendChild(skeleton);
        }

        function hideSkeleton(el) {
            if (!el) return;
            el.querySelectorAll('.api-skeleton').forEach(s => s.remove());
        }

        // Add skeleton animation
        const skelStyle = document.createElement('style');
        skelStyle.textContent = `
            @keyframes skeleton-pulse { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
            .api-error-banner { background:rgba(239,68,68,0.15); border:1px solid #ef4444; color:#ef4444; padding:12px 20px; border-radius:12px; margin:10px 40px; display:flex; align-items:center; gap:10px; font-size:0.9rem; }
            .api-error-banner i { font-size:1.1rem; }
            .refresh-indicator { position:fixed; top:20px; right:20px; background:var(--dark-card,#1e293b); border:1px solid var(--dark-border,#334155); border-radius:12px; padding:8px 16px; font-size:0.8rem; color:var(--text-secondary,#94a3b8); z-index:1000; display:none; gap:8px; align-items:center; }
            .refresh-indicator.visible { display:flex; }
            .refresh-indicator .spinner { width:14px; height:14px; border:2px solid rgba(255,255,255,0.2); border-top-color:#ff6b00; border-radius:50%; animation:spin 0.8s linear infinite; }
            @keyframes spin { to{transform:rotate(360deg)} }
            a:focus-visible, button:focus-visible, [tabindex]:focus-visible { outline: 2px solid #ff6b00; outline-offset: 2px; }
            .skip-to-content { position:absolute; top:-40px; left:0; background:#ff6b00; color:white; padding:8px 16px; z-index:9999; transition:top 0.2s; }
            .skip-to-content:focus { top:0; }
            .metric-drill-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:10000; align-items:center; justify-content:center; }
            .metric-drill-modal.show { display:flex; }
            .metric-drill-content { background:var(--dark-card,#1e293b); border:1px solid var(--dark-border,#334155); border-radius:16px; padding:30px; max-width:600px; width:90%; max-height:80vh; overflow-y:auto; }
            .metric-drill-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
            .metric-drill-close { background:none; border:none; color:var(--text-secondary,#94a3b8); font-size:1.5rem; cursor:pointer; }
            .date-range-filter { display:flex; gap:8px; align-items:center; }
            .date-range-filter select { background:var(--dark-bg,#0f172a); color:var(--text-primary,#f8fafc); border:1px solid var(--dark-border,#334155); padding:6px 12px; border-radius:8px; font-size:0.85rem; }
            .keyboard-help-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:10001; align-items:center; justify-content:center; }
            .keyboard-help-modal.show { display:flex; }
            .kbd { background:var(--dark-bg,#0f172a); border:1px solid var(--dark-border,#334155); padding:2px 8px; border-radius:4px; font-family:monospace; font-size:0.85rem; }
        `;
        document.head.appendChild(skelStyle);

        // ===== SKIP TO CONTENT LINK =====
        const skipLink = document.createElement('a');
        skipLink.href = '#main-content';
        skipLink.className = 'skip-to-content';
        skipLink.textContent = 'Skip to main content';
        document.body.prepend(skipLink);

        // Add id to main content area
        const mainContent = document.querySelector('.dashboard') || document.querySelector('.main-area');
        if (mainContent) mainContent.id = 'main-content';

        // ===== ARIA LANDMARKS =====
        const header = document.querySelector('.header');
        if (header) header.setAttribute('role', 'banner');
        const nav = document.querySelector('.sidebar') || document.querySelector('.nav-section');
        if (nav) nav.setAttribute('role', 'navigation');
        if (mainContent) mainContent.setAttribute('role', 'main');

        // Add aria-labels to buttons
        document.querySelectorAll('button:not([aria-label])').forEach(btn => {
            const text = btn.textContent.trim();
            if (text) btn.setAttribute('aria-label', text);
        });

        // ===== REFRESH INDICATOR =====
        const refreshIndicator = document.createElement('div');
        refreshIndicator.className = 'refresh-indicator';
        refreshIndicator.innerHTML = '<div class="spinner"></div><span>Refreshing...</span>';
        document.body.appendChild(refreshIndicator);

        // ===== DATE RANGE FILTER =====
        const headerStats = document.querySelector('.header-stats') || document.querySelector('.header');
        if (headerStats) {
            const filterDiv = document.createElement('div');
            filterDiv.className = 'date-range-filter';
            filterDiv.innerHTML = `
                <select id="globalDateRange" aria-label="Date range filter">
                    <option value="7d">Last 7 Days</option>
                    <option value="30d" selected>Last 30 Days</option>
                    <option value="90d">Last 90 Days</option>
                    <option value="ytd">Year to Date</option>
                    <option value="all">All Time</option>
                </select>
            `;
            headerStats.appendChild(filterDiv);

            document.getElementById('globalDateRange').addEventListener('change', function() {
                loadAllMetrics();
            });
        }

        // ===== DRILL-DOWN MODAL =====
        const drillModal = document.createElement('div');
        drillModal.className = 'metric-drill-modal';
        drillModal.id = 'metricDrillModal';
        drillModal.innerHTML = `
            <div class="metric-drill-content">
                <div class="metric-drill-header">
                    <h3 id="drillTitle" style="color:var(--text-primary)">Metric Details</h3>
                    <button class="metric-drill-close" id="closeDrill" aria-label="Close details">&times;</button>
                </div>
                <div id="drillBody"></div>
            </div>
        `;
        document.body.appendChild(drillModal);

        document.getElementById('closeDrill').addEventListener('click', () => {
            drillModal.classList.remove('show');
        });
        drillModal.addEventListener('click', (e) => {
            if (e.target === drillModal) drillModal.classList.remove('show');
        });

        function showDrill(title, html) {
            document.getElementById('drillTitle').textContent = title;
            document.getElementById('drillBody').innerHTML = html;
            drillModal.classList.add('show');
        }

        // ===== KEYBOARD HELP MODAL =====
        const kbModal = document.createElement('div');
        kbModal.className = 'keyboard-help-modal';
        kbModal.innerHTML = `
            <div class="metric-drill-content">
                <div class="metric-drill-header">
                    <h3 style="color:var(--text-primary)">Keyboard Shortcuts</h3>
                    <button class="metric-drill-close" onclick="this.closest('.keyboard-help-modal').classList.remove('show')" aria-label="Close help">&times;</button>
                </div>
                <div style="display:grid; gap:12px;">
                    <div><span class="kbd">?</span> Show this help</div>
                    <div><span class="kbd">Ctrl+K</span> Search</div>
                    <div><span class="kbd">J</span> Next metric card</div>
                    <div><span class="kbd">K</span> Previous metric card</div>
                    <div><span class="kbd">Enter</span> Drill into focused metric</div>
                    <div><span class="kbd">Esc</span> Close modal / deselect</div>
                    <div><span class="kbd">R</span> Refresh data</div>
                </div>
            </div>
        `;
        document.body.appendChild(kbModal);

        // ===== KEYBOARD SHORTCUTS =====
        let focusedCardIndex = -1;
        const metricCards = () => document.querySelectorAll('[style*="border-radius: 12px"][style*="padding: 20px"]');

        document.addEventListener('keydown', function(e) {
            // Don't trigger if typing in input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;

            if (e.key === '?' && !e.ctrlKey) {
                e.preventDefault();
                kbModal.classList.toggle('show');
            } else if (e.key === 'k' && e.ctrlKey) {
                e.preventDefault();
                const searchInput = document.querySelector('#globalSearch, [type="search"], input[placeholder*="Search"]');
                if (searchInput) searchInput.focus();
            } else if (e.key === 'j' && !e.ctrlKey) {
                e.preventDefault();
                const cards = metricCards();
                if (cards.length > 0) {
                    focusedCardIndex = Math.min(focusedCardIndex + 1, cards.length - 1);
                    cards[focusedCardIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
                    cards[focusedCardIndex].style.outline = '2px solid #ff6b00';
                    if (focusedCardIndex > 0) cards[focusedCardIndex - 1].style.outline = '';
                }
            } else if (e.key === 'k' && !e.ctrlKey) {
                e.preventDefault();
                const cards = metricCards();
                if (cards.length > 0 && focusedCardIndex > 0) {
                    cards[focusedCardIndex].style.outline = '';
                    focusedCardIndex--;
                    cards[focusedCardIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
                    cards[focusedCardIndex].style.outline = '2px solid #ff6b00';
                }
            } else if (e.key === 'Escape') {
                drillModal.classList.remove('show');
                kbModal.classList.remove('show');
                const cards = metricCards();
                cards.forEach(c => c.style.outline = '');
                focusedCardIndex = -1;
            } else if (e.key === 'r' && !e.ctrlKey && !e.metaKey) {
                e.preventDefault();
                loadAllMetrics();
            }
        });

        // ===== ERROR STATE =====
        let errorBanner = null;
        function showError(msg) {
            if (errorBanner) errorBanner.remove();
            errorBanner = document.createElement('div');
            errorBanner.className = 'api-error-banner';
            errorBanner.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ' + msg + ' <button onclick="this.parentElement.remove()" style="margin-left:auto;background:none;border:none;color:#ef4444;cursor:pointer;font-size:1.2rem">&times;</button>';
            const dashboard = document.querySelector('.dashboard');
            if (dashboard) dashboard.prepend(errorBanner);
        }

        function clearError() {
            if (errorBanner) { errorBanner.remove(); errorBanner = null; }
        }

        // ===== LIVE DATA LOADING =====
        function updateElement(selector, value) {
            const els = document.querySelectorAll(selector);
            els.forEach(el => {
                el.textContent = value;
                el.setAttribute('aria-live', 'polite');
            });
        }

        function formatCurrency(val) {
            if (val >= 1000000) return '$' + (val / 1000000).toFixed(1) + 'M';
            if (val >= 1000) return '$' + (val / 1000).toFixed(0) + 'K';
            return '$' + Math.round(val).toLocaleString();
        }

        async function loadFinancialMetrics() {
            const section = document.getElementById('financialHealthSection');
            if (section) showSkeleton(section);

            const data = await apiFetch('/api/metrics/financial');
            if (section) hideSkeleton(section);

            if (!data) return;

            // Update financial health cards by finding them within the section
            if (section) {
                const cards = section.querySelectorAll('[style*="border-radius: 12px"]');
                if (cards[0]) {
                    const val = cards[0].querySelector('[style*="font-size: 2rem"]');
                    if (val) val.textContent = formatCurrency(data.mrr);
                    cards[0].style.cursor = 'pointer';
                    cards[0].onclick = () => showDrill('MRR Details', '<p style="color:var(--text-secondary)">Monthly Recurring Revenue: ' + formatCurrency(data.mrr) + '</p><p style="color:var(--text-secondary);margin-top:10px">ARR (Annual): ' + formatCurrency(data.arr) + '</p><p style="color:var(--text-secondary);margin-top:10px">Active Revenue: ' + formatCurrency(data.activeRevenue) + '</p>');
                }
                if (cards[1]) {
                    const val = cards[1].querySelector('[style*="font-size: 2rem"]');
                    if (val) val.textContent = formatCurrency(data.cac);
                }
                if (cards[2]) {
                    const val = cards[2].querySelector('[style*="font-size: 2rem"]');
                    if (val) val.textContent = formatCurrency(data.ltv);
                }
                if (cards[3]) {
                    const val = cards[3].querySelector('[style*="font-size: 2rem"]');
                    if (val) val.textContent = data.ltvCacRatio + ':1';
                }
                if (cards[4]) {
                    const val = cards[4].querySelector('[style*="font-size: 2rem"]');
                    if (val) val.textContent = data.churnRate + '%';
                }
            }
        }

        async function loadSalesMetrics() {
            const section = document.getElementById('salesPipelineSection');
            if (section) showSkeleton(section);

            const data = await apiFetch('/api/metrics/sales');
            if (section) hideSkeleton(section);

            if (!data) return;

            // Update pipeline total and win rate in header
            if (section) {
                const headerValues = section.querySelectorAll('[style*="font-size: 1.5rem"]');
                if (headerValues[0]) headerValues[0].textContent = formatCurrency(data.stages.reduce((s, st) => s + parseFloat(st.total_value || 0), 0));
                if (headerValues[1]) headerValues[1].textContent = data.winRate + '%';
            }
        }

        async function loadAgentMetrics() {
            const data = await apiFetch('/api/agents/progress');
            if (!data) return;

            // Update agent-related displays
            if (data.systemMetrics) {
                const agentCountEls = document.querySelectorAll('[id*="agentCount"], [id*="activeAgent"]');
                agentCountEls.forEach(el => {
                    el.textContent = data.systemMetrics.activeAgents + '/' + data.systemMetrics.totalAgents;
                });
            }
        }

        async function loadEngagementMetrics() {
            const data = await apiFetch('/api/metrics/engagement');
            if (!data) return;

            // NPS is a new metric - log it
            if (data.nps !== undefined) {
                console.log('NPS Score:', data.nps, data.npsCategory);
            }
        }

        async function loadAllMetrics() {
            refreshIndicator.classList.add('visible');
            clearError();

            try {
                await Promise.all([
                    loadFinancialMetrics(),
                    loadSalesMetrics(),
                    loadAgentMetrics(),
                    loadEngagementMetrics()
                ]);
                console.log('All metrics refreshed at', new Date().toISOString());
            } catch (err) {
                showError('Unable to connect to the backend API. Showing cached data.');
            }

            refreshIndicator.classList.remove('visible');
        }

        // ===== ROLE-BASED VIEW (Enhanced) =====
        function applyRoleView() {
            const params = new URLSearchParams(window.location.search);
            const urlView = params.get('view');
            const session = JSON.parse(localStorage.getItem('ascent_session') || '{}');
            const stored = localStorage.getItem('ascent_role_view');
            // Priority: URL param > localStorage > session role > null
            const view = urlView || stored || (session.role ? session.role.toLowerCase() : null);
            if (view) localStorage.setItem('ascent_role_view', view);

            const fin = document.getElementById('financialHealthSection');
            const pipe = document.getElementById('salesPipelineSection');
            const li = document.getElementById('linkedinCampaignSection');
            const agents = document.getElementById('agentRegistrySection');
            const parent = fin ? fin.parentElement : null;

            // Clean up previous role injections
            document.querySelectorAll('.role-injected').forEach(el => el.remove());

            // --- Role Switcher Toggle (top-right corner) ---
            if (view || session.role) {
                const isCeo = (view === 'ceo');
                const switchTo = isCeo ? 'cto' : 'ceo';
                const switchLabel = isCeo ? 'Switch to CTO View' : 'Switch to CEO View';
                const switcher = document.createElement('div');
                switcher.className = 'role-injected';
                switcher.style.cssText = 'position:fixed;top:18px;right:24px;z-index:10000;';
                switcher.innerHTML = `<button onclick="localStorage.setItem('ascent_role_view','${switchTo}');const u=new URL(window.location);u.searchParams.set('view','${switchTo}');window.location.href=u.toString();" style="background:var(--dark-card);color:#e2e8f0;border:1px solid var(--dark-border);padding:8px 16px;border-radius:8px;cursor:pointer;font-size:0.85rem;display:flex;align-items:center;gap:8px;transition:border-color 0.2s;"><i class="fas fa-exchange-alt"></i> ${switchLabel}</button>`;
                document.body.appendChild(switcher);
            }

            // ===== CEO VIEW =====
            if (view === 'ceo') {
                // Reorder: Financial -> Sales Pipeline -> LinkedIn -> Agents
                if (parent && fin) {
                    parent.prepend(fin);
                    if (pipe) fin.after(pipe);
                    if (li) (pipe || fin).after(li);
                    if (agents) (li || pipe || fin).after(agents);
                }

                // --- Revenue Summary Banner ---
                const revBanner = document.createElement('div');
                revBanner.className = 'role-injected';
                revBanner.style.cssText = 'background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border:1px solid var(--dark-border);border-left:4px solid var(--success);border-radius:12px;padding:20px 28px;margin-bottom:24px;';
                revBanner.innerHTML = `
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px;">
                        <i class="fas fa-chart-line" style="color:var(--success);font-size:1.2rem;"></i>
                        <span style="font-size:1.1rem;font-weight:700;color:#e2e8f0;">Revenue Summary</span>
                    </div>
                    <div style="display:flex;flex-wrap:wrap;gap:24px;">
                        <div style="min-width:120px;"><div style="color:#94a3b8;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.5px;">MRR</div><div style="color:#22c55e;font-size:1.5rem;font-weight:700;">$12.4K</div></div>
                        <div style="min-width:120px;"><div style="color:#94a3b8;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.5px;">ARR</div><div style="color:#22c55e;font-size:1.5rem;font-weight:700;">$148.8K</div></div>
                        <div style="min-width:120px;"><div style="color:#94a3b8;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.5px;">Pipeline Total</div><div style="color:#3b82f6;font-size:1.5rem;font-weight:700;">$285K</div></div>
                        <div style="min-width:120px;"><div style="color:#94a3b8;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.5px;">Q1 Forecast</div><div style="color:#f59e0b;font-size:1.5rem;font-weight:700;">$67K</div></div>
                        <div style="margin-left:auto;display:flex;align-items:center;">
                            <a href="ASCENT_XR_ROI_TEMPLATE.html" target="_blank" style="display:inline-flex;align-items:center;gap:8px;background:var(--success);color:#fff;padding:10px 20px;border-radius:8px;text-decoration:none;font-weight:600;font-size:0.9rem;transition:opacity 0.2s;" onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'"><i class="fas fa-calculator"></i> Open ROI Calculator</a>
                        </div>
                    </div>`;
                if (parent && fin) parent.insertBefore(revBanner, fin);

                // --- Deal Closing Quick-Actions ---
                const dealActions = document.createElement('div');
                dealActions.className = 'role-injected';
                dealActions.style.cssText = 'background:var(--dark-card);border:1px solid var(--dark-border);border-left:4px solid #3b82f6;border-radius:12px;padding:20px 28px;margin-bottom:24px;';
                dealActions.innerHTML = `
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
                        <i class="fas fa-handshake" style="color:#3b82f6;font-size:1.1rem;"></i>
                        <span style="font-size:1rem;font-weight:700;color:#e2e8f0;">Deal Closing</span>
                    </div>
                    <div style="display:flex;flex-wrap:wrap;gap:12px;">
                        <button onclick="alert('Schedule Demo: Feature coming soon')" style="background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:0.88rem;font-weight:600;display:flex;align-items:center;gap:8px;transition:opacity 0.2s;" onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'"><i class="fas fa-calendar-check"></i> Schedule Demo</button>
                        <button onclick="alert('Send Proposal: Feature coming soon')" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:0.88rem;font-weight:600;display:flex;align-items:center;gap:8px;transition:opacity 0.2s;" onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'"><i class="fas fa-file-invoice"></i> Send Proposal</button>
                        <button onclick="alert('Review Contract: Feature coming soon')" style="background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:0.88rem;font-weight:600;display:flex;align-items:center;gap:8px;transition:opacity 0.2s;" onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'"><i class="fas fa-file-contract"></i> Review Contract</button>
                    </div>`;
                if (parent && fin) parent.insertBefore(dealActions, fin);

                // --- Hide technical agent details (card stats, detail rows with tech info) ---
                if (agents) {
                    // Hide agent card stats rows (success rate, completed, pending counts)
                    agents.querySelectorAll('.agent-card-stats').forEach(el => { el.style.display = 'none'; });
                    // Hide the search/filter controls (technical filtering)
                    const searchBox = agents.querySelector('.agent-search-box');
                    if (searchBox) searchBox.style.display = 'none';
                    const filterBtns = agents.querySelector('.agent-filter-buttons');
                    if (filterBtns) filterBtns.style.display = 'none';
                }
                // Also patch the modal open to hide technical detail rows for CEO
                const origOpenModal = window.openAgentModal;
                if (origOpenModal) {
                    window.openAgentModal = function(id) {
                        origOpenModal(id);
                        setTimeout(() => {
                            const body = document.getElementById('modalAgentBody');
                            if (body) {
                                body.querySelectorAll('.agent-detail-row').forEach(row => {
                                    const label = row.querySelector('.agent-detail-label');
                                    if (label) {
                                        const t = label.textContent.trim();
                                        if (['Status','Availability','Success Rate','Tasks Completed','Tasks Pending','Contact Method'].includes(t)) {
                                            row.style.display = 'none';
                                        }
                                    }
                                });
                            }
                        }, 50);
                    };
                }

                console.log('CEO dashboard view active (enhanced)');

            // ===== CTO VIEW =====
            } else if (view === 'cto') {
                // Reorder: Agents -> LinkedIn -> Sales Pipeline -> Financial
                if (parent && agents) {
                    parent.prepend(agents);
                    if (li) agents.after(li);
                    if (pipe) (li || agents).after(pipe);
                    if (fin) (pipe || li || agents).after(fin);
                }

                // --- System Health Banner ---
                const sysBanner = document.createElement('div');
                sysBanner.className = 'role-injected';
                sysBanner.style.cssText = 'background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border:1px solid var(--dark-border);border-left:4px solid #06b6d4;border-radius:12px;padding:20px 28px;margin-bottom:24px;';
                sysBanner.innerHTML = `
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px;">
                        <i class="fas fa-server" style="color:#06b6d4;font-size:1.2rem;"></i>
                        <span style="font-size:1.1rem;font-weight:700;color:#e2e8f0;">System Health</span>
                        <span style="margin-left:auto;font-size:0.78rem;color:#22c55e;display:flex;align-items:center;gap:6px;"><span style="width:8px;height:8px;background:#22c55e;border-radius:50%;display:inline-block;animation:pulse 2s infinite;"></span> All Systems Operational</span>
                    </div>
                    <div style="display:flex;flex-wrap:wrap;gap:24px;">
                        <div style="min-width:130px;"><div style="color:#94a3b8;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.5px;">Agent Uptime</div><div style="color:#22c55e;font-size:1.5rem;font-weight:700;">99.7%</div></div>
                        <div style="min-width:130px;"><div style="color:#94a3b8;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.5px;">Avg API Response</div><div style="color:#06b6d4;font-size:1.5rem;font-weight:700;">142ms</div></div>
                        <div style="min-width:130px;"><div style="color:#94a3b8;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.5px;">Deploy Status</div><div style="color:#22c55e;font-size:1.5rem;font-weight:700;">Stable</div></div>
                        <div style="min-width:130px;"><div style="color:#94a3b8;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.5px;">Active Agents</div><div style="color:#f59e0b;font-size:1.5rem;font-weight:700;">11 / 22</div></div>
                    </div>
                    <style>@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}</style>`;
                if (parent && agents) parent.insertBefore(sysBanner, agents);

                // --- Tech Actions ---
                const techActions = document.createElement('div');
                techActions.className = 'role-injected';
                techActions.style.cssText = 'background:var(--dark-card);border:1px solid var(--dark-border);border-left:4px solid #60a5fa;border-radius:12px;padding:20px 28px;margin-bottom:24px;';
                techActions.innerHTML = `
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
                        <i class="fas fa-terminal" style="color:#60a5fa;font-size:1.1rem;"></i>
                        <span style="font-size:1rem;font-weight:700;color:#e2e8f0;">Tech Actions</span>
                    </div>
                    <div style="display:flex;flex-wrap:wrap;gap:12px;">
                        <button onclick="alert('Deploy Update: Feature coming soon')" style="background:linear-gradient(135deg,#06b6d4,#0891b2);color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:0.88rem;font-weight:600;display:flex;align-items:center;gap:8px;transition:opacity 0.2s;" onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'"><i class="fas fa-rocket"></i> Deploy Update</button>
                        <button onclick="alert('View Logs: Feature coming soon')" style="background:linear-gradient(135deg,#60a5fa,#3b82f6);color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:0.88rem;font-weight:600;display:flex;align-items:center;gap:8px;transition:opacity 0.2s;" onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'"><i class="fas fa-scroll"></i> View Logs</button>
                        <button onclick="alert('Run Tests: Feature coming soon')" style="background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-size:0.88rem;font-weight:600;display:flex;align-items:center;gap:8px;transition:opacity 0.2s;" onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'"><i class="fas fa-vial"></i> Run Tests</button>
                    </div>`;
                if (parent && agents) parent.insertBefore(techActions, agents);

                // --- Show expanded agent details (ensure all stats visible) ---
                if (agents) {
                    agents.querySelectorAll('.agent-card-stats').forEach(el => { el.style.display = ''; });
                    const searchBox = agents.querySelector('.agent-search-box');
                    if (searchBox) searchBox.style.display = '';
                    const filterBtns = agents.querySelector('.agent-filter-buttons');
                    if (filterBtns) filterBtns.style.display = '';
                }

                console.log('CTO dashboard view active (enhanced)');
            }
        }

        // ===== AUTO-REFRESH (60 seconds) =====
        let refreshInterval = null;
        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = setInterval(loadAllMetrics, 60000);
        }

        // Pause refresh when tab not visible
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (refreshInterval) clearInterval(refreshInterval);
            } else {
                loadAllMetrics();
                startAutoRefresh();
            }
        });

        // ===== INIT =====
        applyRoleView();

        // Load live data if token is available
        if (getAuthToken()) {
            loadAllMetrics();
            startAutoRefresh();
        }

        console.log('API integration layer loaded');
    })();
    </script>
</body>
</html>